<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>pic_out_util.f90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>pic_out_util.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.4% of total for source files.">357 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/pic_out_util.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">pic_out_util.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/pic_out_util.html">pic_out_util</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/pic_out_util.f90.html#src">pic_out_util.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~pic_out_util.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilepic_out_utilf90EfferentGraph" width="641pt" height="265pt"
 viewBox="0.00 0.00 641.00 265.39" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph" class="graph" transform="scale(.6303 .6303) rotate(0) translate(4 417.0558)">
<title>sourcefile~~pic_out_util.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-417.0558 1013,-417.0558 1013,4 -4,4"/>
<!-- sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~pic_out_util.f90</title>
<polygon fill="none" stroke="#000000" points="1009,-246 916,-246 916,-222 1009,-222 1009,-246"/>
<text text-anchor="middle" x="962.5" y="-231.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">pic_out_util.f90</text>
</g>
<!-- sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~mpi_field_interface.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/mpi_field_interface.f90.html" xlink:title="mpi_field_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="741,-266 606,-266 606,-242 741,-242 741,-266"/>
<text text-anchor="middle" x="673.5" y="-251.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_field_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M915.7802,-239.7547C889.9372,-243.2429 857.3138,-248.1484 828.5,-254"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M828.5,-254C803.6995,-259.0365 776.203,-260.3727 751.338,-260.0474"/>
<polygon fill="#ff0000" stroke="#ff0000" points="751.2993,-256.5458 741.2243,-259.8237 751.1445,-263.5441 751.2993,-256.5458"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~mpi_curr_interface.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/mpi_curr_interface.f90.html" xlink:title="mpi_curr_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="740,-346 607,-346 607,-322 740,-322 740,-346"/>
<text text-anchor="middle" x="673.5" y="-331.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_curr_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M828.5,-254C804.5911,-258.8555 798.2231,-260.9671 777,-273 759.1272,-283.1334 758.403,-291.0794 741,-302 731.9261,-307.694 721.6803,-313.0451 711.9635,-317.6818"/>
<polygon fill="#ff0000" stroke="#ff0000" points="710.4679,-314.5172 702.8651,-321.8962 713.4101,-320.8689 710.4679,-314.5172"/>
</g>
<!-- sourcefile~psolve.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~psolve.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/psolve.f90.html" xlink:title="psolve.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="862,-226 795,-226 795,-202 862,-202 862,-226"/>
<text text-anchor="middle" x="828.5" y="-211.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">psolve.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M915.6333,-227.005C901.5601,-224.9045 886.1804,-222.609 872.3126,-220.5392"/>
<polygon fill="#ff0000" stroke="#ff0000" points="872.4563,-217.0219 862.0491,-219.0073 871.4229,-223.9453 872.4563,-217.0219"/>
</g>
<!-- sourcefile~phys_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~phys_param.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/phys_param.f90.html" xlink:title="phys_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="247,-24 149,-24 149,0 247,0 247,-24"/>
<text text-anchor="middle" x="198" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">phys_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~phys_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~phys_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M955.0197,-221.7481C925.5654,-175.2082 812.3735,-12 673.5,-12 673.5,-12 673.5,-12 508.5,-12 421.0537,-12 319.7544,-12 257.2714,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="257.2061,-8.5001 247.206,-12 257.206,-15.5001 257.2061,-8.5001"/>
</g>
<!-- sourcefile~grid_part_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~grid_part_util.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/grid_part_util.f90.html" xlink:title="grid_part_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="880,-306 777,-306 777,-282 880,-282 880,-306"/>
<text text-anchor="middle" x="828.5" y="-291.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~grid_part_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~grid_part_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M935.3831,-246.1419C915.0408,-255.2504 886.9863,-267.8121 864.7237,-277.7804"/>
<polygon fill="#ff0000" stroke="#ff0000" points="863.2731,-274.5951 855.5766,-281.8762 866.1338,-280.9839 863.2731,-274.5951"/>
</g>
<!-- sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~pstruct_data.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/pstruct_data.f90.html" xlink:title="pstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="558,-307 459,-307 459,-283 558,-283 558,-307"/>
<text text-anchor="middle" x="508.5" y="-292.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M624.887,-266.0796C606.6733,-270.6054 585.7924,-275.794 566.7913,-280.5155"/>
<polygon fill="#ff0000" stroke="#ff0000" points="565.9112,-277.1277 557.0504,-282.936 567.5994,-283.9211 565.9112,-277.1277"/>
</g>
<!-- sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~fstruct_data.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/fstruct_data.f90.html" xlink:title="fstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="556.5,-368 460.5,-368 460.5,-344 556.5,-344 556.5,-368"/>
<text text-anchor="middle" x="508.5" y="-353.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M653.9244,-266.1013C624.8977,-284.0451 570.2847,-317.8058 536.8729,-338.4604"/>
<polygon fill="#ff0000" stroke="#ff0000" points="534.7157,-335.6791 528.0501,-343.9145 538.3965,-341.6333 534.7157,-335.6791"/>
</g>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~parallel.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/parallel.f90.html" xlink:title="parallel.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="546.5,-143 470.5,-143 470.5,-119 546.5,-119 546.5,-143"/>
<text text-anchor="middle" x="508.5" y="-128.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">parallel.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M658.4228,-241.9678C644.335,-230.4641 622.9852,-212.3506 606,-195 588.5642,-177.1891 590.5512,-166.1025 570,-152 565.7484,-149.0825 561.0546,-146.5373 556.2122,-144.3246"/>
<polygon fill="#ff0000" stroke="#ff0000" points="557.3744,-141.0185 546.7938,-140.4687 554.7222,-147.4966 557.3744,-141.0185"/>
</g>
<!-- sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~grid_param.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/grid_param.f90.html" xlink:title="grid_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="397.5,-230 303.5,-230 303.5,-206 397.5,-206 397.5,-230"/>
<text text-anchor="middle" x="350.5" y="-215.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M605.9648,-257.0796C576.056,-257.7554 540.4768,-257.6194 508.5,-255"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M622.6482,-321.9805C605.3112,-317.8826 585.7764,-313.2653 567.8327,-309.0241"/>
<polygon fill="#cbff00" stroke="#cbff00" points="568.5887,-305.6064 558.0517,-306.7122 566.9785,-312.4187 568.5887,-305.6064"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M606.8638,-342.8848C593.5958,-344.6539 579.759,-346.4988 566.7968,-348.2271"/>
<polygon fill="#cbff00" stroke="#cbff00" points="566.066,-344.7935 556.6164,-349.5845 566.9912,-351.7321 566.066,-344.7935"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M654.5257,-321.9364C639.305,-311.3226 618.4874,-294.5418 606,-275 575.3292,-227.0026 609.3745,-193.1594 570,-152 566.0517,-147.8727 561.2599,-144.5566 556.1127,-141.8921"/>
<polygon fill="#cbff00" stroke="#cbff00" points="557.137,-138.5219 546.5691,-137.7656 554.3588,-144.947 557.137,-138.5219"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M658.2461,-321.9371C630.3999,-301.0568 568.6424,-259.9265 508.5,-255"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M800.8782,-226.0176C792.8836,-229.9995 784.3395,-234.7667 777,-240 758.8305,-252.9555 761.2973,-265.7265 741,-275 686.2997,-299.9916 616.8629,-302.725 568.1711,-300.6102"/>
<polygon fill="#00ff66" stroke="#00ff66" points="568.2754,-297.111 558.1085,-300.0916 567.915,-304.1017 568.2754,-297.111"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M794.9568,-226.0207C788.2903,-229.6669 781.8583,-234.2708 777,-240 742.3616,-280.8476 784.0899,-323.1942 741,-355 687.2622,-394.6653 605.8577,-383.4721 555.0028,-370.5949"/>
<polygon fill="#00ff66" stroke="#00ff66" points="555.8194,-367.1905 545.2564,-368.0115 554.0259,-373.9569 555.8194,-367.1905"/>
</g>
<!-- sourcefile~prl_fft.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~prl_fft.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/prl_fft.f90.html" xlink:title="prl_fft.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="705.5,-64 641.5,-64 641.5,-40 705.5,-40 705.5,-64"/>
<text text-anchor="middle" x="673.5" y="-49.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">prl_fft.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M823.699,-201.6256C812.8758,-175.2609 784.107,-113.1005 741,-78 733.4112,-71.8207 724.1876,-66.9941 715.0277,-63.2694"/>
<polygon fill="#00ff66" stroke="#00ff66" points="716.1698,-59.9601 705.5765,-59.7761 713.7429,-66.526 716.1698,-59.9601"/>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="411,-104 290,-104 290,-80 411,-80 411,-104"/>
<text text-anchor="middle" x="350.5" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M822.3352,-201.7783C810.2376,-179.2629 781.0376,-131.6509 741,-111 648.8239,-63.4568 611.4508,-103.5664 508.5,-91"/>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M508.5,-91C480.1712,-87.2163 448.7303,-86.6781 421.4028,-87.3704"/>
<polygon fill="#00ff66" stroke="#00ff66" points="421.0312,-83.8802 411.1457,-87.6917 421.2504,-90.8768 421.0312,-83.8802"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M794.781,-215.4425C751.0434,-217.6417 672.4728,-222.7117 606,-233 562.0999,-239.7946 552.7745,-258.6267 508.5,-255"/>
</g>
<!-- sourcefile~grid_fields.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~grid_fields.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/grid_fields.f90.html" xlink:title="grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="717.5,-144 629.5,-144 629.5,-120 717.5,-120 717.5,-144"/>
<text text-anchor="middle" x="673.5" y="-129.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M814.1978,-201.9381C797.5488,-188.4124 768.776,-166.5964 741,-153 736.6804,-150.8855 732.1015,-148.9263 727.444,-147.1244"/>
<polygon fill="#00ff66" stroke="#00ff66" points="728.4256,-143.7576 717.8313,-143.6473 726.0444,-150.3402 728.4256,-143.7576"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-146 0,-146 0,-122 106,-122 106,-146"/>
<text text-anchor="middle" x="53" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M158.2189,-24.1198C152.5441,-26.6342 146.9581,-29.5816 142,-33 110.207,-54.9202 82.3778,-90.6205 66.6406,-113.1803"/>
<polygon fill="#0066ff" stroke="#0066ff" points="63.5836,-111.4512 60.8458,-121.6863 69.3687,-115.3925 63.5836,-111.4512"/>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M820.2246,-306.1325C806.1431,-325.9229 775.6558,-365.2249 741,-388 714.3917,-405.4864 705.2278,-409.3312 673.5,-412"/>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M673.5,-412C616.368,-416.8057 617.0544,-367.7573 570,-335 559.1385,-327.4387 546.9624,-319.4257 536.3282,-312.5734"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="538.1296,-309.5709 527.8208,-307.1259 534.3548,-315.4659 538.1296,-309.5709"/>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M673.5,-412C623.2922,-416.2232 568.5713,-391.2459 536.4632,-373.2772"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="538.0541,-370.1545 527.6419,-368.1957 534.56,-376.2201 538.0541,-370.1545"/>
</g>
<!-- sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~grid_part_lib.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/grid_part_lib.f90.html" xlink:title="grid_part_lib.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="723,-186 624,-186 624,-162 723,-162 723,-186"/>
<text text-anchor="middle" x="673.5" y="-171.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_lib.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~grid_part_lib.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M800.8782,-281.9824C792.8836,-278.0005 784.3395,-273.2333 777,-268 758.8305,-255.0445 757.4066,-248.1261 741,-233 726.1221,-219.2833 708.9457,-204.2811 695.6431,-192.8372"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="697.7867,-190.0648 687.9161,-186.2148 693.2314,-195.3799 697.7867,-190.0648"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M350.5,-276C283.5223,-265.6169 259.0466,-305.4473 198,-276"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M198,-276C171.1318,-263.0394 164.3129,-258.7992 142,-239 112.4921,-212.8164 84.0306,-176.7381 67.5369,-154.4151"/>
<polygon fill="#ff0000" stroke="#ff0000" points="70.3459,-152.3269 61.6268,-146.3079 64.6893,-156.4505 70.3459,-152.3269"/>
</g>
<!-- sourcefile~struct_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node20" class="node">
<title>sourcefile~struct_def.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node20"><a xlink:href=".././sourcefile/struct_def.f90.html" xlink:title="struct_def.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="240.5,-230 155.5,-230 155.5,-206 240.5,-206 240.5,-230"/>
<text text-anchor="middle" x="198" y="-215.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">struct_def.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M458.9216,-289.9162C427.7296,-286.5007 386.6752,-281.608 350.5,-276"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M350.5,-276C306.93,-269.2456 259.9649,-249.2626 229.8409,-234.6348"/>
<polygon fill="#ff0000" stroke="#ff0000" points="231.1925,-231.3984 220.6778,-230.0972 228.086,-237.6714 231.1925,-231.3984"/>
</g>
<!-- sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M460.4599,-349.6289C397.6539,-339.9799 285.366,-318.1432 198,-276"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M470.2526,-121.5592C451.8869,-117.0259 429.4746,-111.4937 409.0276,-106.4467"/>
<polygon fill="#aaff00" stroke="#aaff00" points="409.7216,-103.013 399.1742,-104.0145 408.0441,-109.809 409.7216,-103.013"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="377.5,-146 323.5,-146 323.5,-122 377.5,-122 377.5,-146"/>
<text text-anchor="middle" x="350.5" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M470.2526,-131.7262C445.1599,-132.2027 412.5135,-132.8225 387.6461,-133.2947"/>
<polygon fill="#aaff00" stroke="#aaff00" points="387.4414,-129.7979 377.5097,-133.4872 387.5743,-136.7966 387.4414,-129.7979"/>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node18" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node18"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="388,-188 313,-188 313,-164 388,-164 388,-188"/>
<text text-anchor="middle" x="350.5" y="-173.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M470.2526,-141.8932C448.4363,-148.1067 420.9102,-155.9465 397.7509,-162.5425"/>
<polygon fill="#aaff00" stroke="#aaff00" points="396.7811,-159.1794 388.1223,-165.2848 398.6985,-165.9117 396.7811,-159.1794"/>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M651.1221,-64.0606C630.3165,-75.1296 598.3554,-91.7678 570,-105 562.8356,-108.3433 555.1234,-111.7507 547.6639,-114.9506"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="546.2519,-111.7476 538.4106,-118.8725 548.9836,-118.1926 546.2519,-111.7476"/>
</g>
<!-- sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node19" class="node">
<title>sourcefile~modern_fft_lib.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node19"><a xlink:href=".././sourcefile/modern_fft_lib.f90.html" xlink:title="modern_fft_lib.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="254,-66 142,-66 142,-42 254,-42 254,-66"/>
<text text-anchor="middle" x="198" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modern_fft_lib.F90</text>
</a>
</g>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M641.1908,-52.1359C564.0165,-52.4605 367.6881,-53.2863 264.1807,-53.7216"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="264.1422,-50.2217 254.157,-53.7638 264.1717,-57.2216 264.1422,-50.2217"/>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M289.5479,-96.0183C247.8237,-99.2871 191.3359,-104.7317 142,-113 131.2111,-114.8081 119.7822,-117.1643 108.8394,-119.6426"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="107.906,-116.2662 98.9589,-121.9406 109.4918,-123.0842 107.906,-116.2662"/>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M316.5071,-205.941C285.9463,-195.7525 239.5992,-181.9034 198,-176"/>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M303.084,-218C286.5752,-218 267.9516,-218 251.018,-218"/>
<polygon fill="#0000ff" stroke="#0000ff" points="250.727,-214.5001 240.7269,-218 250.7269,-221.5001 250.727,-214.5001"/>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M629.283,-131.732C606.9322,-131.5966 579.7645,-131.4319 556.8597,-131.2931"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="556.6895,-127.7921 546.6685,-131.2313 556.647,-134.792 556.6895,-127.7921"/>
</g>
<!-- sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~grid_field_param.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node17"><a xlink:href=".././sourcefile/grid_field_param.f90.html" xlink:title="grid_field_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="570,-185 447,-185 447,-161 570,-161 570,-185"/>
<text text-anchor="middle" x="508.5" y="-170.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_field_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M629.283,-142.9872C610.0868,-147.7572 587.3375,-153.4101 566.7874,-158.5165"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="565.7618,-155.1648 556.901,-160.9731 567.4499,-161.9582 565.7618,-155.1648"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M623.6931,-162.1308C617.4782,-159.6197 611.4132,-156.6064 606,-153 585.2573,-139.1807 590.7564,-123.7988 570,-110 546.1762,-94.1619 536.8973,-94.4662 508.5,-91"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M633.9517,-186.0648C624.4167,-189.816 614.5278,-194.455 606,-200 587.0301,-212.3347 589.3784,-224.3176 570,-236 545.4998,-250.7702 537.0125,-257.3356 508.5,-255"/>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M508.5,-255C470.4952,-251.8869 428.5104,-241.7226 397.3781,-232.8336"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="398.2503,-229.4422 387.6703,-230.0029 396.2907,-236.1624 398.2503,-229.4422"/>
</g>
<!-- sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node21" class="node">
<title>sourcefile~stretched_grid.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node21"><a xlink:href=".././sourcefile/stretched_grid.f90.html" xlink:title="stretched_grid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="563,-227 454,-227 454,-203 563,-203 563,-227"/>
<text text-anchor="middle" x="508.5" y="-212.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">stretched_grid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M624.887,-186.0796C606.6733,-190.6054 585.7924,-195.794 566.7913,-200.5155"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="565.9112,-197.1277 557.0504,-202.936 567.5994,-203.9211 565.9112,-197.1277"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M323.4053,-142.7285C283.0218,-155.5447 210.439,-177.7652 198,-176"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M198,-176C162.3701,-170.9437 123.2464,-159.2284 94.6273,-149.4522"/>
<polygon fill="#ff0000" stroke="#ff0000" points="95.5603,-146.071 84.9654,-146.0892 93.2591,-152.682 95.5603,-146.071"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node22" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node22"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="238.5,-146 157.5,-146 157.5,-122 238.5,-122 238.5,-146"/>
<text text-anchor="middle" x="198" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M323.2361,-134C302.529,-134 273.4636,-134 248.5457,-134"/>
<polygon fill="#ff0000" stroke="#ff0000" points="248.5153,-130.5001 238.5152,-134 248.5152,-137.5001 248.5153,-130.5001"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M464.2356,-160.888C458.2155,-158.392 452.2945,-155.4477 447,-152 427.2327,-139.1277 430.7348,-125.9222 411,-113 408.4319,-111.3184 405.714,-109.7553 402.9085,-108.3046"/>
<polygon fill="#ffff00" stroke="#ffff00" points="404.2709,-105.0784 393.7264,-104.047 401.3262,-111.4289 404.2709,-105.0784"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M466.1589,-185.0592C446.5988,-190.6301 423.1861,-197.2983 402.5577,-203.1734"/>
<polygon fill="#ffff00" stroke="#ffff00" points="401.3426,-199.8803 392.6838,-205.9856 403.2601,-206.6125 401.3426,-199.8803"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M446.9607,-174.1685C430.9091,-174.4732 413.8452,-174.7972 398.6029,-175.0867"/>
<polygon fill="#ffff00" stroke="#ffff00" points="398.3081,-171.5915 388.3763,-175.2808 398.441,-178.5903 398.3081,-171.5915"/>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M312.6899,-178.9396C281.7034,-180.6453 236.7953,-181.5055 198,-176"/>
</g>
<!-- sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M170.3586,-66.0981C161.2242,-70.29 151.0793,-75.157 142,-80 120.8163,-91.2996 97.6521,-105.413 80.2672,-116.3773"/>
<polygon fill="#00ffff" stroke="#00ffff" points="78.3077,-113.4755 71.7439,-121.7922 82.0614,-119.384 78.3077,-113.4755"/>
</g>
<!-- sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M172.6363,-205.9727C162.9407,-201.2053 151.8514,-195.5446 142,-190 120.595,-177.9528 97.1056,-163.1002 79.6354,-151.7189"/>
<polygon fill="#0000ff" stroke="#0000ff" points="81.3731,-148.673 71.0912,-146.1169 77.5349,-154.527 81.3731,-148.673"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M459.9747,-202.8613C455.2688,-200.4245 450.8297,-197.5026 447,-194 417.9293,-167.4126 440.0036,-139.6607 411,-113 409.6775,-111.7844 408.281,-110.6385 406.8251,-109.5585"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="408.2848,-106.3462 397.9384,-104.0652 404.6042,-112.3004 408.2848,-106.3462"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M453.6827,-216.0408C438.8371,-216.3227 422.7306,-216.6285 407.7547,-216.9129"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="407.5285,-213.4165 397.5968,-217.1058 407.6615,-220.4152 407.5285,-213.4165"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M459.8056,-202.9805C440.1934,-198.1395 417.6442,-192.5736 398.1397,-187.7592"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="398.7966,-184.3163 388.2492,-185.3178 397.1191,-191.1124 398.7966,-184.3163"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M157.2235,-134C144.4842,-134 130.1169,-134 116.213,-134"/>
<polygon fill="#ff0000" stroke="#ff0000" points="116.2006,-130.5001 106.2006,-134 116.2006,-137.5001 116.2006,-130.5001"/>
</g>
</g>
</svg>
</div><script>var pansourcefilepic_out_utilf90EfferentGraph = svgPanZoom('#sourcefilepic_out_utilf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~pic_out_util.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilepic_out_utilf90AfferentGraph" width="213pt" height="32pt"
 viewBox="0.00 0.00 213.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~pic_out_util.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~pic_out_util.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 209,-28 209,4 -4,4"/>
<!-- sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~pic_out_util.f90</title>
<polygon fill="none" stroke="#000000" points="93,-24 0,-24 0,0 93,0 93,-24"/>
<text text-anchor="middle" x="46.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">pic_out_util.f90</text>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~pic_out_util.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="205,-24 129,-24 129,0 205,0 205,-24"/>
<text text-anchor="middle" x="167" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M128.873,-12C120.7455,-12 111.9942,-12 103.3372,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="103.261,-8.5001 93.2609,-12 103.2609,-15.5001 103.261,-8.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/pic_out_util.html">pic_out_util</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/pic_out_util.f90.html#src">pic_out_util.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">pic_out_util</span>
<a name="ln-23"></a>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">grid_part_util</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">mpi_curr_interface</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">mpi_field_interface</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">psolve</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">phys_param</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">electron_mass</span>
<a name="ln-29"></a>
<a name="ln-30"></a>  <span class="k">implicit none</span>
<a name="ln-31"></a>  <span class="c">!=====Contains functions to prepare selected output variables=======</span>
<a name="ln-32"></a> <span class="k">contains</span>
<a name="ln-33"></a>  <span class="c">!=============== Tracking particles============</span>
<a name="ln-34"></a>  <span class="k">subroutine </span><span class="n">initial_tparticles_select</span><span class="p">(</span><span class="n">tx1</span><span class="p">,</span> <span class="n">ty1</span><span class="p">)</span>
<a name="ln-35"></a>
<a name="ln-36"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tx1</span><span class="p">,</span> <span class="n">ty1</span>
<a name="ln-37"></a>
<a name="ln-38"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">ik_max</span>
<a name="ln-39"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">hp_int</span><span class="p">)</span> <span class="kd">::</span> <span class="n">plab</span><span class="p">,</span> <span class="n">last_ind</span>
<a name="ln-40"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">tp_numb</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-41"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">yy</span><span class="p">(</span><span class="n">tp_numb</span><span class="p">),</span> <span class="n">ym</span><span class="p">,</span> <span class="n">ymx</span>
<a name="ln-42"></a>   <span class="c">!========================</span>
<a name="ln-43"></a>   <span class="c">! Define track_tot_nstep</span>
<a name="ln-44"></a>   <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-45"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">dt_loc</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="n">p</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">((</span><span class="n">t_out</span> <span class="o">-</span> <span class="n">t_in</span><span class="p">)</span><span class="o">/</span><span class="n">dt_loc</span><span class="p">)</span>
<a name="ln-46"></a>   <span class="n">track_tot_nstep</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">tkjump</span><span class="p">,</span> <span class="n">dp</span><span class="p">))</span>
<a name="ln-47"></a>   <span class="n">ndv</span> <span class="o">=</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-48"></a>
<a name="ln-49"></a>   <span class="c">! Select particles on each mpi_task</span>
<a name="ln-50"></a>   <span class="c">! xp defined by tx1</span>
<a name="ln-51"></a>   <span class="c">! yp [-4,-3,-2.-1.,0,1,2,3,4], 9 test particles allocated</span>
<a name="ln-52"></a>   <span class="c">!</span>
<a name="ln-53"></a>   <span class="n">yy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ty1</span>
<a name="ln-54"></a>   <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">tp_numb</span>
<a name="ln-55"></a>    <span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">=</span> <span class="n">yy</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span>
<a name="ln-56"></a>   <span class="k">end do</span>
<a name="ln-57"></a><span class="k">   </span><span class="n">ym</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-58"></a>   <span class="n">ymx</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-59"></a>   <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-60"></a>   <span class="n">ik</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-61"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-62"></a><span class="k">    deallocate</span> <span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-63"></a>    <span class="k">deallocate</span> <span class="p">(</span><span class="n">ebfp</span><span class="p">)</span>
<a name="ln-64"></a>    <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-65"></a>   <span class="k">end if</span>
<a name="ln-66"></a><span class="k">   select case</span> <span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
<a name="ln-67"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-68"></a>    <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tp_numb</span>
<a name="ln-69"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">ym</span> <span class="o">&lt;</span> <span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ymx</span> <span class="o">&gt;=</span> <span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-70"></a><span class="k">      </span><span class="n">ik</span> <span class="o">=</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-71"></a>     <span class="k">end if</span>
<a name="ln-72"></a><span class="k">    end do</span>
<a name="ln-73"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ik</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-74"></a><span class="k">     </span><span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ik</span>
<a name="ln-75"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ik</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<a name="ln-76"></a>     <span class="n">np</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-77"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tp_numb</span>
<a name="ln-78"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ym</span> <span class="o">&lt;</span> <span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ymx</span> <span class="o">&gt;=</span> <span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-79"></a><span class="k">       </span><span class="n">np</span> <span class="o">=</span> <span class="n">np</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-80"></a>       <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tx1</span>
<a name="ln-81"></a>       <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-82"></a>       <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">t0_pl</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-83"></a>       <span class="n">part_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">hp_int</span><span class="p">)</span>
<a name="ln-84"></a>       <span class="n">wgh</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sp</span><span class="p">)</span>
<a name="ln-85"></a>       <span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">hp_int</span><span class="p">)</span>
<a name="ln-86"></a>       <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">wgh_cmp</span>
<a name="ln-87"></a>      <span class="k">end if</span>
<a name="ln-88"></a><span class="k">     end do</span>
<a name="ln-89"></a><span class="k">    end if</span>
<a name="ln-90"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-91"></a>    <span class="k">return</span>
<a name="ln-92"></a><span class="k">   end select</span>
<a name="ln-93"></a><span class="k">   </span><span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-94"></a>   <span class="n">loc_tpart</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span>
<a name="ln-95"></a>   <span class="k">call </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">loc_tpart</span><span class="p">,</span> <span class="n">npe</span><span class="p">)</span>
<a name="ln-96"></a>   <span class="n">track_tot_part</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-97"></a>   <span class="n">ik_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-98"></a>   <span class="n">last_ind</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-99"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">mype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">last_ind</span> <span class="o">=</span> <span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-100"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">mype</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">last_ind</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">mype</span><span class="p">))</span>
<a name="ln-101"></a>   <span class="c">!if(loc_tpart(mype+1)&gt;0)write(6,*)&#39;last particle index&#39;,mype,last_ind</span>
<a name="ln-102"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">np</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-103"></a><span class="k">    do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-104"></a>     <span class="n">wgh_cmp</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ndv</span><span class="p">)</span>
<a name="ln-105"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">part_ind</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">part_ind</span> <span class="o">=</span> <span class="n">part_ind</span> <span class="o">+</span> <span class="n">last_ind</span>
<a name="ln-106"></a>     <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ndv</span><span class="p">)</span> <span class="o">=</span> <span class="n">wgh_cmp</span>
<a name="ln-107"></a>    <span class="k">end do</span>
<a name="ln-108"></a><span class="k">   end if</span>
<a name="ln-109"></a><span class="k">   allocate</span> <span class="p">(</span><span class="n">track_aux</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ndv</span><span class="o">*</span><span class="n">ik_max</span><span class="p">))</span>
<a name="ln-110"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">ebfp</span><span class="p">))</span> <span class="k">allocate</span> <span class="p">(</span><span class="n">ebfp</span><span class="p">(</span><span class="n">ik_max</span><span class="p">,</span> <span class="n">ndv</span><span class="p">))</span>
<a name="ln-111"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-112"></a><span class="k">    allocate</span> <span class="p">(</span><span class="n">pdata_tracking</span><span class="p">(</span><span class="n">ndv</span><span class="p">,</span> <span class="n">track_tot_part</span><span class="p">,</span> <span class="n">track_tot_nstep</span><span class="p">))</span>
<a name="ln-113"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;==== Initial track-Particle data===========&#39;</span>
<a name="ln-114"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;(a19,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;  tot_track_steps  &#39;</span><span class="p">,</span> <span class="n">track_tot_nstep</span>
<a name="ln-115"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;(a19,2i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;  tot_track_parts  &#39;</span><span class="p">,</span> <span class="n">track_tot_part</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-116"></a>     <span class="n">tp_numb</span>
<a name="ln-117"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;(a18,i8)&#39;</span><span class="p">)</span> <span class="s1">&#39;  short_int size  &#39;</span><span class="p">,</span> <span class="nb">huge</span><span class="p">(</span><span class="n">plab</span><span class="p">)</span>
<a name="ln-118"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;(a20,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;  track memory(MB) &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-119"></a>     <span class="mf">1.e-06</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">ndv</span><span class="o">*</span><span class="n">track_tot_nstep</span><span class="o">*</span><span class="n">track_tot_part</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>
<a name="ln-120"></a>   <span class="k">end if</span>
<a name="ln-121"></a><span class="k">  end subroutine</span>
<a name="ln-122"></a>  <span class="c">!============================================</span>
<a name="ln-123"></a>  <span class="k">subroutine </span><span class="n">t_particles_collect</span><span class="p">(</span><span class="n">time_ind</span><span class="p">)</span>
<a name="ln-124"></a>
<a name="ln-125"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">time_ind</span>
<a name="ln-126"></a>
<a name="ln-127"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="n">ik_max</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">ndvp</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">kk</span><span class="p">,</span> <span class="n">ik1</span><span class="p">,</span> <span class="n">ik2</span><span class="p">,</span> <span class="n">nst</span>
<a name="ln-128"></a>   <span class="kt">logical</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-129"></a>   <span class="kt">real</span> <span class="kd">::</span> <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">zm</span>
<a name="ln-130"></a>
<a name="ln-131"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">time_ind</span> <span class="o">&gt;</span> <span class="n">track_tot_nstep</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-132"></a><span class="k">   </span><span class="n">xm</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-133"></a>   <span class="n">ym</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-134"></a>   <span class="n">zm</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">imodz</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-135"></a>   <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-136"></a>   <span class="n">nst</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-137"></a>   <span class="n">ndv</span> <span class="o">=</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-138"></a>   <span class="n">ndvp</span> <span class="o">=</span> <span class="n">ndv</span>
<a name="ln-139"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="n">nst</span> <span class="o">=</span> <span class="n">str_indx</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-140"></a>   <span class="c">!===================</span>
<a name="ln-141"></a>   <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-142"></a>   <span class="n">ik</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-143"></a>   <span class="c">!=========== each pe counts track particle number</span>
<a name="ln-144"></a>   <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-145"></a>    <span class="n">wgh_cmp</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ndv</span><span class="p">)</span>
<a name="ln-146"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">part_ind</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ik</span> <span class="o">=</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-147"></a>   <span class="k">end do</span>
<a name="ln-148"></a><span class="k">   </span><span class="n">loc_tpart</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ik</span>
<a name="ln-149"></a>   <span class="k">call </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">ik</span><span class="p">,</span> <span class="n">loc_tpart</span><span class="p">,</span> <span class="n">npe</span><span class="p">)</span>
<a name="ln-150"></a>   <span class="n">ik_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-151"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">ndvp</span><span class="o">*</span><span class="n">ik_max</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">(</span><span class="n">track_aux</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-152"></a><span class="k">    deallocate</span> <span class="p">(</span><span class="n">track_aux</span><span class="p">)</span>
<a name="ln-153"></a>    <span class="k">allocate</span> <span class="p">(</span><span class="n">track_aux</span><span class="p">(</span><span class="n">ndvp</span><span class="o">*</span><span class="n">ik_max</span><span class="p">))</span>
<a name="ln-154"></a>   <span class="k">end if</span>
<a name="ln-155"></a>   <span class="c">!========= each pe stores tpart data in track_aux(ndv,loc_tpart)</span>
<a name="ln-156"></a>   <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-157"></a>   <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-158"></a>    <span class="n">wgh_cmp</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ndv</span><span class="p">)</span>
<a name="ln-159"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">part_ind</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-160"></a><span class="k">     do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ndv</span>
<a name="ln-161"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-162"></a>      <span class="n">track_aux</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ip</span><span class="p">)</span>
<a name="ln-163"></a>     <span class="k">end do</span>
<a name="ln-164"></a><span class="k">    end if</span>
<a name="ln-165"></a><span class="k">   end do</span>
<a name="ln-166"></a>   <span class="c">!=================</span>
<a name="ln-167"></a>   <span class="c">!  all data are gathered onto pe0</span>
<a name="ln-168"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-169"></a><span class="k">    </span><span class="n">sr</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-170"></a>    <span class="n">ik1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-171"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-172"></a>     <span class="n">ik</span> <span class="o">=</span> <span class="n">loc_tpart</span><span class="p">(</span><span class="n">ipe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-173"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">ik</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-174"></a><span class="k">      call </span><span class="n">exchange_1d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">track_aux</span><span class="p">,</span> <span class="n">ik</span><span class="o">*</span><span class="n">ndvp</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">ipe</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-175"></a>      <span class="c">!pe0 receives from ipe ik sp_aux data and collects on track array</span>
<a name="ln-176"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-177"></a>      <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ik</span>
<a name="ln-178"></a>       <span class="n">ik2</span> <span class="o">=</span> <span class="n">ik1</span> <span class="o">+</span> <span class="n">p</span>
<a name="ln-179"></a>       <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ndv</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-180"></a>        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-181"></a>        <span class="n">pdata_tracking</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">ik2</span><span class="p">,</span> <span class="n">time_ind</span><span class="p">)</span> <span class="o">=</span> <span class="n">track_aux</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-182"></a>        <span class="c">!pdata_tracking(ip,ik2,time_ind)=track_aux(kk)</span>
<a name="ln-183"></a>       <span class="k">end do</span>
<a name="ln-184"></a><span class="k">       </span><span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-185"></a>       <span class="n">wgh_cmp</span> <span class="o">=</span> <span class="n">track_aux</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-186"></a>       <span class="n">pdata_tracking</span><span class="p">(</span><span class="n">ndv</span><span class="p">,</span> <span class="n">ik2</span><span class="p">,</span> <span class="n">time_ind</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">part_ind</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>
<a name="ln-187"></a>      <span class="k">end do</span>
<a name="ln-188"></a><span class="k">      </span><span class="n">ik1</span> <span class="o">=</span> <span class="n">ik2</span>
<a name="ln-189"></a>     <span class="k">end if</span>
<a name="ln-190"></a><span class="k">    end do</span>
<a name="ln-191"></a><span class="k">    </span><span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ik2</span>
<a name="ln-192"></a>   <span class="k">else</span>
<a name="ln-193"></a><span class="k">    </span><span class="n">ik</span> <span class="o">=</span> <span class="n">loc_tpart</span><span class="p">(</span><span class="n">mype</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-194"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ik</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-195"></a><span class="k">     </span><span class="n">sr</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-196"></a>     <span class="k">call </span><span class="n">exchange_1d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">track_aux</span><span class="p">,</span> <span class="n">ik</span><span class="o">*</span><span class="n">ndvp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mype</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span> <span class="c">!sends ik data to pe0</span>
<a name="ln-197"></a>    <span class="k">end if</span>
<a name="ln-198"></a><span class="k">   end if</span>
<a name="ln-199"></a><span class="k">  end subroutine</span>
<a name="ln-200"></a>  <span class="c">!=================================================</span>
<a name="ln-201"></a>  <span class="k">subroutine </span><span class="n">fill_density_data</span><span class="p">(</span><span class="n">den</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-202"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">den</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-203"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ic</span>
<a name="ln-204"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">,</span> <span class="n">n_loc</span>
<a name="ln-205"></a>
<a name="ln-206"></a>   <span class="n">n_loc</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">ng</span>
<a name="ln-207"></a>   <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-208"></a>    <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-209"></a>     <span class="n">iy</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">imody</span><span class="o">*</span><span class="n">n_loc</span>
<a name="ln-210"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">iy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ymin_t</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">y</span><span class="p">(</span><span class="n">iy</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ymax_t</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-211"></a><span class="k">      do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-212"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">targ_in</span><span class="p">)</span> <span class="n">den</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">den</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span>
<a name="ln-213"></a>      <span class="k">end do</span>
<a name="ln-214"></a><span class="k">     end if</span>
<a name="ln-215"></a><span class="k">    end do</span>
<a name="ln-216"></a><span class="k">   end do</span>
<a name="ln-217"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-218"></a><span class="k">   </span><span class="n">n_loc</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">imodz</span><span class="p">)%</span><span class="n">ng</span>
<a name="ln-219"></a>   <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-220"></a>    <span class="n">iz</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">imodz</span><span class="o">*</span><span class="n">n_loc</span>
<a name="ln-221"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">z</span><span class="p">(</span><span class="n">iz</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">zmin_t</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">z</span><span class="p">(</span><span class="n">iz</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">zmax_t</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-222"></a><span class="k">     do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-223"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-224"></a>       <span class="n">den</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">den</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span>
<a name="ln-225"></a>      <span class="k">end do</span>
<a name="ln-226"></a><span class="k">     end do</span>
<a name="ln-227"></a><span class="k">    end if</span>
<a name="ln-228"></a><span class="k">   end do</span>
<a name="ln-229"></a><span class="k">  end subroutine</span>
<a name="ln-230"></a>  <span class="c">!=============================================</span>
<a name="ln-231"></a>  <span class="k">subroutine </span><span class="n">collect_bunch_and_plasma_density</span><span class="p">(</span><span class="n">this_bunch</span><span class="p">,</span> <span class="n">isp</span><span class="p">)</span>
<a name="ln-232"></a>
<a name="ln-233"></a>   <span class="c">!========== bunch density and particles of species isp added on jc(ic)</span>
<a name="ln-234"></a>   <span class="c">!=========================================</span>
<a name="ln-235"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">this_bunch</span><span class="p">,</span> <span class="n">isp</span>
<a name="ln-236"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dery</span><span class="p">,</span> <span class="n">derz</span>
<a name="ln-237"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-238"></a>
<a name="ln-239"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<a name="ln-240"></a>    <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-241"></a>   <span class="k">end do</span>
<a name="ln-242"></a><span class="k">   </span><span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">isp</span><span class="p">)</span>
<a name="ln-243"></a>
<a name="ln-244"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">this_bunch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-245"></a><span class="k">    do </span><span class="n">ik</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-246"></a>     <span class="n">nb</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ik</span><span class="p">)</span>
<a name="ln-247"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-248"></a><span class="k">      call </span><span class="n">set_grid_charge</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="n">ik</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-249"></a>     <span class="k">end if</span>
<a name="ln-250"></a><span class="k">    end do</span>
<a name="ln-251"></a><span class="k">   else</span>
<a name="ln-252"></a><span class="k">    </span><span class="n">ik</span> <span class="o">=</span> <span class="n">this_bunch</span> <span class="c">!only the selected bunch density</span>
<a name="ln-253"></a>    <span class="n">nb</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ik</span><span class="p">)</span>
<a name="ln-254"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-255"></a><span class="k">     call </span><span class="n">set_grid_charge</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="n">ik</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-256"></a>    <span class="k">end if</span>
<a name="ln-257"></a><span class="k">   end if</span>
<a name="ln-258"></a>   <span class="c">!=========== bunch data on jc(1)</span>
<a name="ln-259"></a>   <span class="c">!==================== data of isp species on jc(2)</span>
<a name="ln-260"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">np</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-261"></a><span class="k">    call </span><span class="n">set_grid_charge</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">isp</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-262"></a>   <span class="k">end if</span>
<a name="ln-263"></a><span class="k">   if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-264"></a><span class="k">    do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<a name="ln-265"></a>     <span class="k">call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-266"></a>    <span class="k">end do</span>
<a name="ln-267"></a><span class="k">   end if</span>
<a name="ln-268"></a><span class="k">   </span><span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-269"></a>                                      <span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-270"></a>   <span class="c">!============ on jc(1) bunch+ particles</span>
<a name="ln-271"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-272"></a><span class="k">    </span><span class="n">kk</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-273"></a>    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-274"></a>     <span class="n">derz</span> <span class="o">=</span> <span class="n">loc_zg</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-275"></a>     <span class="n">jj</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-276"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-277"></a>      <span class="n">dery</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span><span class="o">*</span><span class="n">derz</span>
<a name="ln-278"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-279"></a>       <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-280"></a>       <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-281"></a>      <span class="k">end do</span>
<a name="ln-282"></a><span class="k">      </span><span class="n">jj</span> <span class="o">=</span> <span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-283"></a>     <span class="k">end do</span>
<a name="ln-284"></a><span class="k">     </span><span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-285"></a>    <span class="k">end do</span>
<a name="ln-286"></a><span class="k">   end if</span>
<a name="ln-287"></a>   <span class="c">!=============================</span>
<a name="ln-288"></a>  <span class="k">end subroutine</span>
<a name="ln-289"></a>
<a name="ln-290"></a><span class="k">  subroutine </span><span class="n">prl_bden_energy_interp</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-291"></a>
<a name="ln-292"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ic</span>
<a name="ln-293"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dery</span><span class="p">,</span> <span class="n">derz</span>
<a name="ln-294"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-295"></a>
<a name="ln-296"></a>   <span class="c">!curr_clean</span>
<a name="ln-297"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<a name="ln-298"></a>    <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-299"></a>   <span class="k">end do</span>
<a name="ln-300"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ic</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">!collects all bunch density</span>
<a name="ln-301"></a>    <span class="k">do </span><span class="n">ik</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-302"></a>     <span class="n">np</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ik</span><span class="p">)</span>
<a name="ln-303"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">np</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-304"></a><span class="k">      call </span><span class="n">set_grid_den_energy</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="n">ik</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>
<a name="ln-305"></a>     <span class="k">end if</span>
<a name="ln-306"></a><span class="k">    end do</span>
<a name="ln-307"></a><span class="k">   else</span>
<a name="ln-308"></a><span class="k">    </span><span class="n">ik</span> <span class="o">=</span> <span class="n">ic</span> <span class="c">!only the ic-bunch density</span>
<a name="ln-309"></a>    <span class="n">np</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ik</span><span class="p">)</span>
<a name="ln-310"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">np</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-311"></a><span class="k">     call </span><span class="n">set_grid_den_energy</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="n">ik</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>
<a name="ln-312"></a>    <span class="k">end if</span>
<a name="ln-313"></a><span class="k">   end if</span>
<a name="ln-314"></a>   <span class="c">!========= den on [i1-1:i2+2,j1-1:nyp+2,k1-1:nzp+2]</span>
<a name="ln-315"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-316"></a><span class="k">    call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-317"></a>   <span class="k">end if</span>
<a name="ln-318"></a>   <span class="c">!do ik=1,2</span>
<a name="ln-319"></a>   <span class="c">! call den_zyxbd(jc,i1,i2,j1,nyf,k1,nzf,ik)</span>
<a name="ln-320"></a>   <span class="c">!end do</span>
<a name="ln-321"></a>   <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="c">!positive for electrons</span>
<a name="ln-322"></a>
<a name="ln-323"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-324"></a><span class="k">    </span><span class="n">kk</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-325"></a>    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-326"></a>     <span class="n">derz</span> <span class="o">=</span> <span class="n">loc_zg</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-327"></a>     <span class="n">jj</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-328"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-329"></a>      <span class="n">dery</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span><span class="o">*</span><span class="n">derz</span>
<a name="ln-330"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-331"></a>       <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-332"></a>       <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-333"></a>      <span class="k">end do</span>
<a name="ln-334"></a><span class="k">      </span><span class="n">jj</span> <span class="o">=</span> <span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-335"></a>     <span class="k">end do</span>
<a name="ln-336"></a><span class="k">     </span><span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-337"></a>    <span class="k">end do</span>
<a name="ln-338"></a><span class="k">   end if</span>
<a name="ln-339"></a>   <span class="c">!=============================</span>
<a name="ln-340"></a>  <span class="k">end subroutine</span>
<a name="ln-341"></a>  <span class="c">!============================</span>
<a name="ln-342"></a>  <span class="k">subroutine </span><span class="n">prl_den_energy_interp</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="n">cmp_out</span><span class="p">)</span>
<a name="ln-343"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ic</span><span class="p">,</span> <span class="n">cmp_out</span>
<a name="ln-344"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dery</span><span class="p">,</span> <span class="n">derz</span><span class="p">,</span> <span class="n">ar</span><span class="p">,</span> <span class="n">ai</span>
<a name="ln-345"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-346"></a>
<a name="ln-347"></a>   <span class="c">!=============================</span>
<a name="ln-348"></a>   <span class="c">! nden=1 only charge density</span>
<a name="ln-349"></a>   <span class="c">! nden =2 charge and energy &lt;n(gamma-1)&gt; density</span>
<a name="ln-350"></a>   <span class="c">!=============================</span>
<a name="ln-351"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmp_out</span>
<a name="ln-352"></a>    <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-353"></a>   <span class="k">end do</span>
<a name="ln-354"></a>   <span class="c">!===========================</span>
<a name="ln-355"></a>   <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-356"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-357"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">cmp_out</span><span class="p">)</span>
<a name="ln-358"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-359"></a>     <span class="k">call </span><span class="n">set_grid_charge</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-360"></a>     <span class="c">!nden=1 exit density for each ic species</span>
<a name="ln-361"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-362"></a>     <span class="c">!nden=2 exit density and energy density for each species</span>
<a name="ln-363"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">envelope</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-364"></a><span class="k">      if</span> <span class="p">(</span><span class="n">ic</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-365"></a><span class="k">       do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-366"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-367"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-368"></a>          <span class="n">ar</span> <span class="o">=</span> <span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">env</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">env</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a name="ln-369"></a>          <span class="n">ai</span> <span class="o">=</span> <span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">env</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">env</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<a name="ln-370"></a>          <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ar</span><span class="o">*</span><span class="n">ar</span> <span class="o">+</span> <span class="n">ai</span><span class="o">*</span><span class="n">ai</span><span class="p">)</span>
<a name="ln-371"></a>         <span class="k">end do</span>
<a name="ln-372"></a><span class="k">        end do</span>
<a name="ln-373"></a><span class="k">       end do</span>
<a name="ln-374"></a><span class="k">       if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_ebfield_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-375"></a>       <span class="k">call </span><span class="n">set_grid_env_den_energy</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-376"></a>      <span class="k">else</span>
<a name="ln-377"></a><span class="k">       call </span><span class="n">set_grid_den_energy</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span> <span class="c">!ic &gt;1 in envelope scheme</span>
<a name="ln-378"></a>      <span class="n">endif</span>
<a name="ln-379"></a>     <span class="k">else</span>
<a name="ln-380"></a><span class="k">      call </span><span class="n">set_grid_den_energy</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>
<a name="ln-381"></a>      <span class="c">! in jc(1) is plasma norm density in jc(2) &lt;(gam-1)density&gt; using kinetic</span>
<a name="ln-382"></a>      <span class="c">! gamma  for each species</span>
<a name="ln-383"></a>     <span class="k">end if</span>
<a name="ln-384"></a><span class="k">    end select</span>
<a name="ln-385"></a><span class="k">    if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">cmp_out</span><span class="p">)</span>
<a name="ln-386"></a>    <span class="k">do </span><span class="n">kk</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmp_out</span>
<a name="ln-387"></a>     <span class="k">call </span><span class="n">den_zyxbd</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">kk</span><span class="p">)</span>
<a name="ln-388"></a>    <span class="k">end do</span>
<a name="ln-389"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ic</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-390"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">cmp_out</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">mass</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span><span class="o">*</span><span class="n">electron_mass</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-391"></a>                                       <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-392"></a>    <span class="c">!=========== energy density in Mev*n/n_0</span>
<a name="ln-393"></a>
<a name="ln-394"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-395"></a><span class="k">     select case</span> <span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
<a name="ln-396"></a>     <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-397"></a>      <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-398"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-399"></a>       <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-400"></a>       <span class="n">dery</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span>
<a name="ln-401"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-402"></a>        <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">cmp_out</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">cmp_out</span><span class="p">)</span>
<a name="ln-403"></a>       <span class="k">end do</span>
<a name="ln-404"></a><span class="k">      end do</span>
<a name="ln-405"></a><span class="k">     case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-406"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-407"></a>       <span class="n">kk</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-408"></a>       <span class="n">derz</span> <span class="o">=</span> <span class="n">loc_zg</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-409"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-410"></a>        <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-411"></a>        <span class="n">dery</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span><span class="o">*</span><span class="n">derz</span>
<a name="ln-412"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-413"></a>         <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">cmp_out</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">cmp_out</span><span class="p">)</span>
<a name="ln-414"></a>        <span class="k">end do</span>
<a name="ln-415"></a><span class="k">       end do</span>
<a name="ln-416"></a><span class="k">      end do</span>
<a name="ln-417"></a><span class="k">     end select</span>
<a name="ln-418"></a><span class="k">    end if</span>
<a name="ln-419"></a><span class="k">   </span><span class="n">endif</span>
<a name="ln-420"></a>   <span class="c">!======================</span>
<a name="ln-421"></a>  <span class="k">end subroutine</span>
<a name="ln-422"></a>  <span class="c">!=====================</span>
<a name="ln-423"></a>  <span class="k">subroutine </span><span class="n">set_wake_potential</span>
<a name="ln-424"></a>
<a name="ln-425"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span>
<a name="ln-426"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span>
<a name="ln-427"></a>
<a name="ln-428"></a>   <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-429"></a>   <span class="c">!curr_clean</span>
<a name="ln-430"></a>   <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-431"></a>    <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-432"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">np</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">set_grid_charge_and_jx</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>
<a name="ln-433"></a>   <span class="k">end do</span>
<a name="ln-434"></a>   <span class="c">!========= jc(1)=charge density jc(2)= Jx at the same current t^{n} time</span>
<a name="ln-435"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-436"></a><span class="k">    call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-437"></a>   <span class="k">end if</span>
<a name="ln-438"></a><span class="k">   if</span> <span class="p">(</span><span class="n">nsp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-439"></a><span class="k">    call </span><span class="n">fill_density_data</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-440"></a>   <span class="k">else</span>
<a name="ln-441"></a><span class="k">    if</span> <span class="p">(</span><span class="n">dmodel_id</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_density_data</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-442"></a>   <span class="k">end if</span>
<a name="ln-443"></a><span class="k">   </span><span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-444"></a>                                      <span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-445"></a>   <span class="c">!============== jc(1)=rho-Jx=======================</span>
<a name="ln-446"></a>
<a name="ln-447"></a>   <span class="n">ft_mod</span> <span class="o">=</span> <span class="mi">2</span> <span class="c">!for cosine transform</span>
<a name="ln-448"></a>   <span class="n">ft_sym</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-449"></a>   <span class="k">call </span><span class="n">fft_2d_psolv</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nx_loc</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">ny_loc</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="n">nz_loc</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-450"></a>                     <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-451"></a>
<a name="ln-452"></a>   <span class="c">!==================================</span>
<a name="ln-453"></a>  <span class="k">end subroutine</span>
<a name="ln-454"></a>  <span class="c">!============================</span>
<a name="ln-455"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-08-08 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>