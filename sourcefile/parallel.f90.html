<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>parallel.F90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>parallel.F90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.9% of total for source files.">724 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/parallel.F90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">parallel.F90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/parallel.html">parallel</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/parallel.f90.html#src">parallel.F90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~parallel.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileparallelf90EfferentGraph" width="494pt" height="114pt"
 viewBox="0.00 0.00 494.00 114.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~parallel.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 110)">
<title>sourcefile~~parallel.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-110 490,-110 490,4 -4,4"/>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~parallel.f90</title>
<polygon fill="none" stroke="#000000" points="486,-66 410,-66 410,-42 486,-42 486,-66"/>
<text text-anchor="middle" x="448" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">parallel.F90</text>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="263,-106 142,-106 142,-82 263,-82 263,-106"/>
<text text-anchor="middle" x="202.5" y="-91.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M410.2668,-66.0147C398.7238,-69.3352 385.926,-72.664 374,-75 341.249,-81.4151 304.5241,-85.845 273.4866,-88.8026"/>
<polygon fill="#ff0000" stroke="#ff0000" points="272.8299,-85.3482 263.1928,-89.75 273.4715,-92.3187 272.8299,-85.3482"/>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="374,-66 299,-66 299,-42 374,-42 374,-66"/>
<text text-anchor="middle" x="336.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M409.9399,-54C401.6873,-54 392.8577,-54 384.2847,-54"/>
<polygon fill="#ff0000" stroke="#ff0000" points="384.0109,-50.5001 374.0108,-54 384.0108,-57.5001 384.0109,-50.5001"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="363.5,-24 309.5,-24 309.5,0 363.5,0 363.5,-24"/>
<text text-anchor="middle" x="336.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M416.0486,-41.9645C402.6886,-36.932 387.0838,-31.054 373.2514,-25.8436"/>
<polygon fill="#ff0000" stroke="#ff0000" points="374.1418,-22.439 363.55,-22.1892 371.6743,-28.9896 374.1418,-22.439"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-66 0,-66 0,-42 106,-42 106,-66"/>
<text text-anchor="middle" x="53" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M157.6451,-81.9987C142.0467,-77.8252 124.3689,-73.0954 108.042,-68.727"/>
<polygon fill="#ff0000" stroke="#ff0000" points="108.6463,-65.2656 98.0814,-66.0619 106.837,-72.0277 108.6463,-65.2656"/>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M298.8954,-52.4423C272.0026,-51.7081 234.9711,-51.4711 202.5,-54"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M310.5083,-24.0113C284.0112,-35.3221 241.39,-50.9711 202.5,-54"/>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M202.5,-54C174.2875,-56.1973 142.9894,-56.523 116.351,-56.1727"/>
<polygon fill="#0000ff" stroke="#0000ff" points="116.0643,-52.6675 106.0073,-56.0003 115.9475,-59.6665 116.0643,-52.6675"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="243,-25 162,-25 162,-1 243,-1 243,-25"/>
<text text-anchor="middle" x="202.5" y="-10.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M309.3831,-12.2024C293.2418,-12.3228 272.2448,-12.4795 253.1386,-12.6221"/>
<polygon fill="#0000ff" stroke="#0000ff" points="253.0331,-9.1227 243.0595,-12.6973 253.0854,-16.1225 253.0331,-9.1227"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M161.6485,-24.2034C144.7252,-28.8446 124.8609,-34.2923 106.7782,-39.2515"/>
<polygon fill="#00ffff" stroke="#00ffff" points="105.6637,-35.9278 96.9455,-41.948 107.5152,-42.6785 105.6637,-35.9278"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~parallel.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileparallelf90AfferentGraph" width="641pt" height="371pt"
 viewBox="0.00 0.00 641.00 371.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~parallel.f90~~AfferentGraph" class="graph" transform="scale(.7436 .7436) rotate(0) translate(4 495.0597)">
<title>sourcefile~~parallel.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-495.0597 858,-495.0597 858,4 -4,4"/>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~parallel.f90</title>
<polygon fill="none" stroke="#000000" points="76,-295.6915 0,-295.6915 0,-271.6915 76,-271.6915 76,-295.6915"/>
<text text-anchor="middle" x="38" y="-281.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">parallel.F90</text>
</g>
<!-- sourcefile~pic_out.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~pic_out.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/pic_out.f90.html" xlink:title="pic_out.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="191.5,-454.6915 120.5,-454.6915 120.5,-430.6915 191.5,-430.6915 191.5,-454.6915"/>
<text text-anchor="middle" x="156" y="-440.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_out.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~pic_out.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M130.147,-430.4816C123.7266,-426.664 117.2013,-422.0297 112,-416.6915 79.8104,-383.6548 57.1124,-333.8319 45.9288,-305.4764"/>
<polygon fill="#ff0000" stroke="#ff0000" points="49.1736,-304.1624 42.3332,-296.0717 42.6352,-306.6622 49.1736,-304.1624"/>
</g>
<!-- sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~mpi_field_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/mpi_field_interface.f90.html" xlink:title="mpi_field_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="371,-335.6915 236,-335.6915 236,-311.6915 371,-311.6915 371,-335.6915"/>
<text text-anchor="middle" x="303.5" y="-321.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_field_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M269.7566,-335.6959C239.6294,-344.7155 194.454,-354.0431 156,-344.6915"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M156,-344.6915C121.7764,-336.3687 86.3893,-316.2655 63.4078,-301.4002"/>
<polygon fill="#ff0000" stroke="#ff0000" points="65.2139,-298.3985 54.9434,-295.7971 61.35,-304.2355 65.2139,-298.3985"/>
</g>
<!-- sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~run_data_info.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/run_data_info.f90.html" xlink:title="run_data_info.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="356.5,-212.6915 250.5,-212.6915 250.5,-188.6915 356.5,-188.6915 356.5,-212.6915"/>
<text text-anchor="middle" x="303.5" y="-198.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">run_data_info.f90</text>
</a>
</g>
</g>
<!-- sourcefile~run_data_info.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~run_data_info.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M264.2829,-212.7719C234.6898,-221.6646 193.002,-233.7182 156,-242.6915"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M156,-242.6915C129.1949,-249.192 99.9,-259.3527 77.2048,-267.9325"/>
<polygon fill="#ff0000" stroke="#ff0000" points="75.675,-264.7706 67.5924,-271.6206 78.1826,-271.306 75.675,-264.7706"/>
</g>
<!-- sourcefile~prl_fft.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~prl_fft.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/prl_fft.f90.html" xlink:title="prl_fft.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="188,-407.6915 124,-407.6915 124,-383.6915 188,-383.6915 188,-407.6915"/>
<text text-anchor="middle" x="156" y="-393.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">prl_fft.f90</text>
</a>
</g>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M140.6317,-383.3585C132.042,-376.32 121.2387,-367.2235 112,-358.6915 92.3174,-340.5145 70.9336,-318.5861 56.2383,-303.1492"/>
<polygon fill="#ff0000" stroke="#ff0000" points="58.6243,-300.5785 49.2077,-295.7226 53.5408,-305.3909 58.6243,-300.5785"/>
</g>
<!-- sourcefile~pic_dump.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~pic_dump.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/pic_dump.f90.html" xlink:title="pic_dump.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="198.5,-136.6915 113.5,-136.6915 113.5,-112.6915 198.5,-112.6915 198.5,-136.6915"/>
<text text-anchor="middle" x="156" y="-122.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_dump.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_dump.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~pic_dump.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M146.9367,-136.9039C126.7243,-164.1393 77.7907,-230.0752 52.9711,-263.5186"/>
<polygon fill="#ff0000" stroke="#ff0000" points="50.0817,-261.539 46.9327,-271.6551 55.7028,-265.7107 50.0817,-261.539"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~mpi_curr_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node7"><a xlink:href=".././sourcefile/mpi_curr_interface.f90.html" xlink:title="mpi_curr_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="370,-377.6915 237,-377.6915 237,-353.6915 370,-353.6915 370,-377.6915"/>
<text text-anchor="middle" x="303.5" y="-363.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_curr_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M236.8956,-358.9958C211.3829,-355.7058 182.1387,-351.0481 156,-344.6915"/>
</g>
<!-- sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node8" class="node">
<title>sourcefile~mpi_part_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node8"><a xlink:href=".././sourcefile/mpi_part_interface.f90.html" xlink:title="mpi_part_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="370,-254.6915 237,-254.6915 237,-230.6915 370,-230.6915 370,-254.6915"/>
<text text-anchor="middle" x="303.5" y="-240.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_part_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_part_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~mpi_part_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M236.9921,-236.0652C211.3587,-235.2269 182.0062,-236.3848 156,-242.6915"/>
</g>
<!-- sourcefile~diag_part_and_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node9" class="node">
<title>sourcefile~diag_part_and_fields.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node9"><a xlink:href=".././sourcefile/diag_part_and_fields.f90.html" xlink:title="diag_part_and_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="742,-36.6915 600,-36.6915 600,-12.6915 742,-12.6915 742,-36.6915"/>
<text text-anchor="middle" x="671" y="-22.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">diag_part_and_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~diag_part_and_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~diag_part_and_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M606.8633,-12.6617C491.6874,4.9294 249.075,23.0872 112,-103.6915 65.2668,-146.9144 47.2402,-224.0089 40.9787,-261.7094"/>
<polygon fill="#ff0000" stroke="#ff0000" points="37.5103,-261.2365 39.452,-271.6519 44.4292,-262.2989 37.5103,-261.2365"/>
</g>
<!-- sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node10" class="node">
<title>sourcefile~grid_fields.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node10"><a xlink:href=".././sourcefile/grid_fields.f90.html" xlink:title="grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="200,-295.6915 112,-295.6915 112,-271.6915 200,-271.6915 200,-295.6915"/>
<text text-anchor="middle" x="156" y="-281.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M111.7254,-283.6915C103.4497,-283.6915 94.7611,-283.6915 86.3692,-283.6915"/>
<polygon fill="#ff0000" stroke="#ff0000" points="86.3278,-280.1916 76.3278,-283.6915 86.3277,-287.1916 86.3278,-280.1916"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node11" class="node">
<title>sourcefile~env_evolve_in_time.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node11"><a xlink:href=".././sourcefile/env_evolve_in_time.f90.html" xlink:title="env_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="739.5,-255.6915 602.5,-255.6915 602.5,-231.6915 739.5,-231.6915 739.5,-255.6915"/>
<text text-anchor="middle" x="671" y="-241.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">env_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge24" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M602.3072,-243.5046C539.3018,-243.3331 446.0974,-243.0795 380.5758,-242.9012"/>
<polygon fill="#0000ff" stroke="#0000ff" points="380.3161,-239.4006 370.3066,-242.8733 380.297,-246.4006 380.3161,-239.4006"/>
</g>
<!-- sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node14" class="node">
<title>sourcefile~window.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node14"><a xlink:href=".././sourcefile/window.f90.html" xlink:title="window.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="521.5,-214.6915 449.5,-214.6915 449.5,-190.6915 521.5,-190.6915 521.5,-214.6915"/>
<text text-anchor="middle" x="485.5" y="-200.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">window.f90</text>
</a>
</g>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge34" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~window.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M616.3472,-231.6119C589.3639,-225.6479 557.1739,-218.5332 531.4741,-212.8529"/>
<polygon fill="#5cff00" stroke="#5cff00" points="532.1299,-209.4134 521.6101,-210.6727 530.6191,-216.2485 532.1299,-209.4134"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node18" class="node">
<title>sourcefile~curr_and_fields_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node18"><a xlink:href=".././sourcefile/curr_and_fields_util.f90.html" xlink:title="curr_and_fields_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="553.5,-336.6915 417.5,-336.6915 417.5,-312.6915 553.5,-312.6915 553.5,-336.6915"/>
<text text-anchor="middle" x="485.5" y="-322.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">curr_and_fields_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge39" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90</title>
<path fill="none" stroke="#002eff" stroke-dasharray="5,2" d="M652.7676,-255.7865C632.0176,-269.0992 596.7498,-290.3738 564,-303.6915 558.8543,-305.784 553.4344,-307.7296 547.9464,-309.524"/>
<polygon fill="#002eff" stroke="#002eff" points="546.5575,-306.29 538.039,-312.5897 548.6267,-312.9772 546.5575,-306.29"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node21" class="node">
<title>sourcefile~fluid_density_momenta.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node21"><a xlink:href=".././sourcefile/fluid_density_momenta.f90.html" xlink:title="fluid_density_momenta.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="564,-294.6915 407,-294.6915 407,-270.6915 564,-270.6915 564,-294.6915"/>
<text text-anchor="middle" x="485.5" y="-280.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fluid_density_momenta.f90</text>
</a>
</g>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge44" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M613.8303,-255.711C594.5239,-259.77 572.7932,-264.3387 552.7781,-268.5468"/>
<polygon fill="#ff008b" stroke="#ff008b" points="551.8662,-265.1619 542.8003,-270.6445 553.3065,-272.0121 551.8662,-265.1619"/>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node12" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node12"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="854,-175.6915 778,-175.6915 778,-151.6915 854,-151.6915 854,-175.6915"/>
<text text-anchor="middle" x="816" y="-161.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge10" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M671,-448.6915C512.5158,-523.7236 294.6344,-480.2807 201.3559,-455.845"/>
<polygon fill="#ff0000" stroke="#ff0000" points="202.2292,-452.4556 191.6646,-453.2563 200.4226,-459.2185 202.2292,-452.4556"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge16" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M782.1484,-151.6484C721.6889,-131.9067 591.5426,-97.4464 485.5,-124.6915"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~diag_part_and_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge27" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~diag_part_and_fields.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M809.3993,-151.6043C797.8816,-131.3732 772.4165,-90.2621 742,-63.6915 732.0548,-55.0037 719.8532,-47.4423 708.3884,-41.3497"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="709.9094,-38.1967 699.409,-36.785 706.7373,-44.4367 709.9094,-38.1967"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge32" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M803.9614,-175.7676C790.1226,-189.0221 766.1887,-210.0883 742,-222.6915 738.2809,-224.6293 734.3565,-226.4143 730.3397,-228.0539"/>
<polygon fill="#ff0000" stroke="#ff0000" points="728.9818,-224.8251 720.8523,-231.6193 731.4444,-231.3776 728.9818,-224.8251"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node13" class="node">
<title>sourcefile~init_beam_part_distrib.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node13"><a xlink:href=".././sourcefile/init_beam_part_distrib.f90.html" xlink:title="init_beam_part_distrib.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="561,-378.6915 410,-378.6915 410,-354.6915 561,-354.6915 561,-378.6915"/>
<text text-anchor="middle" x="485.5" y="-364.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_beam_part_distrib.f90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge33" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M814.753,-175.9139C809.1324,-223.5134 781.3865,-396.4306 671,-448.6915"/>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M671,-448.6915C621.524,-472.1152 614.635,-408.4915 564,-387.6915 558.8617,-385.5808 553.447,-383.6226 547.9624,-381.8199"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="548.6475,-378.3677 538.0593,-378.7436 546.5708,-385.0526 548.6475,-378.3677"/>
</g>
<!-- sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node16" class="node">
<title>sourcefile~pic_out_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node16"><a xlink:href=".././sourcefile/pic_out_util.f90.html" xlink:title="pic_out_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="532,-420.6915 439,-420.6915 439,-396.6915 532,-396.6915 532,-420.6915"/>
<text text-anchor="middle" x="485.5" y="-406.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_out_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge37" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M671,-448.6915C658.9963,-454.3745 588.5169,-437.0281 537.99,-423.4093"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="538.7416,-419.9867 528.1738,-420.7431 536.9068,-426.742 538.7416,-419.9867"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node17" class="node">
<title>sourcefile~pic_evolve_in_time.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node17"><a xlink:href=".././sourcefile/pic_evolve_in_time.f90.html" xlink:title="pic_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="737.5,-213.6915 604.5,-213.6915 604.5,-189.6915 737.5,-189.6915 737.5,-213.6915"/>
<text text-anchor="middle" x="671" y="-199.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge38" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90</title>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M777.903,-173.6755C762.2613,-177.7747 743.8384,-182.6028 726.7329,-187.0856"/>
<polygon fill="#00b9ff" stroke="#00b9ff" points="725.6307,-183.7562 716.8447,-189.677 727.4053,-190.5275 725.6307,-183.7562"/>
</g>
<!-- sourcefile~start_all.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node20" class="node">
<title>sourcefile~start_all.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node20"><a xlink:href=".././sourcefile/start_all.f90.html" xlink:title="start_all.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="709.5,-96.6915 632.5,-96.6915 632.5,-72.6915 709.5,-72.6915 709.5,-96.6915"/>
<text text-anchor="middle" x="671" y="-82.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">start_all.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~start_all.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge43" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~start_all.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M801.7461,-151.6877C787.3795,-140.0351 764.2132,-122.4338 742,-110.6915 734.822,-106.8971 726.968,-103.4185 719.1835,-100.3245"/>
<polygon fill="#e700ff" stroke="#e700ff" points="720.364,-97.0289 709.7729,-96.746 717.8759,-103.5719 720.364,-97.0289"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge11" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M434.3185,-354.5992C412.5211,-349.4492 386.9269,-343.4022 364.1847,-338.0291"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="364.8342,-334.5862 354.2973,-335.6931 363.2246,-341.3987 364.8342,-334.5862"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge23" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M409.8967,-366.2761C400.1112,-366.2223 390.081,-366.1672 380.2767,-366.1133"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="380.1802,-362.6129 370.1611,-366.0578 380.1416,-369.6128 380.1802,-362.6129"/>
</g>
<!-- sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node19" class="node">
<title>sourcefile~psolve.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node19"><a xlink:href=".././sourcefile/psolve.f90.html" xlink:title="psolve.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="337,-419.6915 270,-419.6915 270,-395.6915 337,-395.6915 337,-419.6915"/>
<text text-anchor="middle" x="303.5" y="-405.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">psolve.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge42" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M431.8784,-378.7711C404.7563,-384.881 372.2725,-392.1988 346.7668,-397.9446"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="345.9938,-394.5309 337.0075,-400.1431 347.5322,-401.3598 345.9938,-394.5309"/>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge12" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M467.8027,-214.9062C451.5227,-226.3927 426.9543,-244.3674 407,-261.6915 389.9136,-276.5257 389.9699,-285.3568 371,-297.6915 365.2704,-301.417 358.9264,-304.7336 352.4881,-307.6467"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="350.9031,-304.5165 343.0483,-311.6266 353.6226,-310.9666 350.9031,-304.5165"/>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge17" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M449.107,-202.2916C425.6512,-202.0338 394.5144,-201.6917 367.0556,-201.3899"/>
<polygon fill="#aaff00" stroke="#aaff00" points="366.7734,-197.8867 356.7355,-201.2765 366.6964,-204.8863 366.7734,-197.8867"/>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge26" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M449.107,-210.69C425.9174,-215.7866 395.2202,-222.5332 367.992,-228.5174"/>
<polygon fill="#0000ff" stroke="#0000ff" points="367.1534,-225.1181 358.1378,-230.6832 368.656,-231.955 367.1534,-225.1181"/>
</g>
<!-- sourcefile~init_laser_field.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node15" class="node">
<title>sourcefile~init_laser_field.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node15"><a xlink:href=".././sourcefile/init_laser_field.f90.html" xlink:title="init_laser_field.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="358,-133.6915 249,-133.6915 249,-109.6915 358,-109.6915 358,-133.6915"/>
<text text-anchor="middle" x="303.5" y="-119.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_laser_field.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_laser_field.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge30" class="edge">
<title>sourcefile~init_laser_field.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M285.5714,-133.7927C270.7763,-144.4899 250.01,-161.2295 236,-179.6915 213.1631,-209.7853 225.1611,-228.5121 200,-256.6915 196.9631,-260.0926 193.3956,-263.2083 189.6282,-266.0176"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="187.5502,-263.1968 181.19,-271.6702 191.4461,-269.0125 187.5502,-263.1968"/>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge13" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M438.7009,-401.1655C427.7512,-398.085 416.5165,-393.7589 407,-387.6915 385.9836,-374.2921 391.7427,-358.5108 371,-344.6915 368.4274,-342.9776 365.7077,-341.3976 362.8946,-339.9419"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="364.207,-336.6933 353.6585,-335.7034 361.2874,-343.0554 364.207,-336.6933"/>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge22" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M438.6305,-397.6179C415.9511,-392.2596 388.4465,-385.7613 364.1868,-380.0296"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="364.9022,-376.6023 354.3654,-377.7091 363.2927,-383.4148 364.9022,-376.6023"/>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge41" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M438.6305,-408.434C410.5196,-408.2795 374.9954,-408.0843 347.426,-407.9328"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="347.3005,-404.4322 337.2813,-407.8771 347.2619,-411.4321 347.3005,-404.4322"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge25" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M638.4321,-189.67C586.8411,-172.6688 484.2593,-147.2831 407,-181.6915 385.1513,-191.4221 391.1388,-208.7888 371,-221.6915 368.2615,-223.446 365.3667,-225.0623 362.3773,-226.5502"/>
<polygon fill="#0000ff" stroke="#0000ff" points="360.901,-223.3761 353.1868,-230.6384 363.7461,-229.7719 360.901,-223.3761"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge35" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~window.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M604.2923,-202.0511C580.2612,-202.1806 553.692,-202.3239 531.7853,-202.442"/>
<polygon fill="#5cff00" stroke="#5cff00" points="531.7376,-198.9421 521.7566,-202.496 531.7754,-205.942 531.7376,-198.9421"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge40" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90</title>
<path fill="none" stroke="#002eff" stroke-dasharray="5,2" d="M613.6144,-213.7178C608.6965,-216.1741 604.0586,-219.1313 600,-222.6915 570.3842,-248.6704 593.9533,-278.1025 564,-303.6915 562.4715,-304.9973 560.8699,-306.2228 559.2081,-307.3729"/>
<polygon fill="#002eff" stroke="#002eff" points="557.304,-304.4323 550.4572,-312.5176 560.8517,-310.4667 557.304,-304.4323"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge45" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M625.4734,-213.7207C616.9073,-216.3868 608.1006,-219.4077 600,-222.6915 569.8381,-234.9182 537.1053,-252.5466 514.3933,-265.5332"/>
<polygon fill="#ff008b" stroke="#ff008b" points="512.5156,-262.5759 505.6093,-270.6104 516.0186,-268.6364 512.5156,-262.5759"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge14" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M417.4711,-324.3177C405.6392,-324.2527 393.2529,-324.1846 381.1858,-324.1183"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="381.1629,-320.6183 371.1438,-324.0632 381.1244,-327.6182 381.1629,-320.6183"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge21" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M431.8784,-336.7711C411.5116,-341.3592 388.1214,-346.6284 366.933,-351.4016"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="366.0389,-348.0153 357.0526,-353.6274 367.5773,-354.8441 366.0389,-348.0153"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge28" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M440.0846,-312.6404C395.2132,-301.065 329.615,-285.1221 303.5,-283.6915"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge19" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M269.6605,-404.9384C248.4186,-403.2103 220.8554,-400.9679 198.1922,-399.1241"/>
<polygon fill="#00ff00" stroke="#00ff00" points="198.4154,-395.6308 188.1645,-398.3083 197.8477,-402.6077 198.4154,-395.6308"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge31" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M269.7321,-402.0811C258.2022,-398.9543 245.7662,-394.1241 236,-386.6915 212.455,-368.7725 218.1851,-354.0315 200,-330.6915 192.6075,-321.2035 183.6554,-311.3875 175.761,-303.1956"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="178.1049,-300.5871 168.6017,-295.903 173.1096,-305.491 178.1049,-300.5871"/>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge18" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M632.425,-92.0943C594.7603,-99.5374 535.9158,-111.7384 485.5,-124.6915"/>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M485.5,-124.6915C430.7011,-138.7708 370.8203,-166.3369 335.247,-184.1144"/>
<polygon fill="#aaff00" stroke="#aaff00" points="333.66,-180.9948 326.3137,-188.6291 336.8174,-187.2423 333.66,-180.9948"/>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~pic_dump.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge20" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~pic_dump.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M632.1361,-75.1799C611.9498,-70.7203 586.7988,-65.9076 564,-63.6915 417.9858,-49.4984 378.0589,-64.0737 236,-100.6915 225.572,-103.3795 214.4617,-106.5277 203.9426,-109.6428"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="202.6514,-106.3761 194.0799,-112.6034 204.664,-113.0805 202.6514,-106.3761"/>
</g>
<!-- sourcefile~pic_in.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node22" class="node">
<title>sourcefile~pic_in.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node22"><a xlink:href=".././sourcefile/pic_in.f90.html" xlink:title="pic_in.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="517.5,-96.6915 453.5,-96.6915 453.5,-72.6915 517.5,-72.6915 517.5,-96.6915"/>
<text text-anchor="middle" x="485.5" y="-82.2915" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_in.f90</text>
</a>
</g>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~pic_in.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge46" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~pic_in.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M632.1131,-84.6915C601.5693,-84.6915 559.0993,-84.6915 527.7274,-84.6915"/>
<polygon fill="#ff0000" stroke="#ff0000" points="527.547,-81.1916 517.547,-84.6915 527.547,-88.1916 527.547,-81.1916"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge15" class="edge">
<title>sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M431.8784,-294.7711C411.5116,-299.3592 388.1214,-304.6284 366.933,-309.4016"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="366.0389,-306.0153 357.0526,-311.6274 367.5773,-312.8441 366.0389,-306.0153"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge29" class="edge">
<title>sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M406.615,-285.1929C374.5925,-285.6695 337.2589,-285.5408 303.5,-283.6915"/>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M303.5,-283.6915C272.7784,-282.0086 238.4034,-281.9054 210.5717,-282.2697"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="210.191,-278.7751 200.2466,-282.43 210.2997,-285.7743 210.191,-278.7751"/>
</g>
<!-- sourcefile~pic_in.f90&#45;&gt;sourcefile~init_laser_field.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge36" class="edge">
<title>sourcefile~pic_in.f90&#45;&gt;sourcefile~init_laser_field.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M453.381,-91.2212C429.8294,-96.0091 397.0566,-102.6717 368.1609,-108.5461"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="367.2256,-105.1646 358.1233,-110.5867 368.6202,-112.0243 367.2256,-105.1646"/>
</g>
</g>
</svg>
</div><script>var pansourcefileparallelf90AfferentGraph = svgPanZoom('#sourcefileparallelf90AfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/parallel.html">parallel</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/parallel.f90.html#src">parallel.F90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">parallel</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">mpi_var</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">common_param</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">util</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">init_random_seed</span>
<a name="ln-26"></a>
<a name="ln-27"></a><span class="cp">#if !defined (_CRESCO)</span>
<a name="ln-28"></a><span class="cp">#define ENABLE_MPI_LONG_INT</span>
<a name="ln-29"></a><span class="cp">#endif</span>
<a name="ln-30"></a>
<a name="ln-31"></a><span class="cp">#if defined (FORCE_OLD_MPI)</span>
<a name="ln-32"></a>  <span class="k">implicit none</span>
<a name="ln-33"></a><span class="k">  include</span> <span class="s1">&#39;mpif.h&#39;</span>
<a name="ln-34"></a><span class="cp">#else</span>
<a name="ln-35"></a>  <span class="k">use </span><span class="n">mpi</span>
<a name="ln-36"></a>  <span class="k">implicit none</span>
<a name="ln-37"></a><span class="cp">#endif</span>
<a name="ln-38"></a>
<a name="ln-39"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">offset_kind</span> <span class="o">=</span> <span class="n">mpi_offset_kind</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-40"></a>                        <span class="n">whence</span> <span class="o">=</span> <span class="n">mpi_seek_set</span>
<a name="ln-41"></a>
<a name="ln-42"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">mpi_err</span>
<a name="ln-43"></a>
<a name="ln-44"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">fp0x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="n">fp1x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-45"></a>
<a name="ln-46"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">status</span><span class="p">(</span><span class="n">mpi_status_size</span><span class="p">),</span> <span class="n">error</span><span class="p">,</span> <span class="n">mpi_sd</span>
<a name="ln-47"></a>
<a name="ln-48"></a> <span class="k">contains</span>
<a name="ln-49"></a>  <span class="c">!==================</span>
<a name="ln-50"></a>
<a name="ln-51"></a>  <span class="k">subroutine </span><span class="n">check_decomposition</span>
<a name="ln-52"></a>
<a name="ln-53"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_yz</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-54"></a><span class="k">    </span><span class="n">nprocy</span> <span class="o">=</span> <span class="n">npe_yz</span>
<a name="ln-55"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nz</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-56"></a><span class="k">     </span><span class="n">nprocz</span> <span class="o">=</span> <span class="n">npe_yz</span>
<a name="ln-57"></a>    <span class="k">else</span>
<a name="ln-58"></a><span class="k">     </span><span class="n">nprocz</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-59"></a>    <span class="k">end if</span>
<a name="ln-60"></a><span class="k">    </span><span class="n">nprocx</span> <span class="o">=</span> <span class="n">mpi_size</span><span class="o">/</span><span class="n">nprocy</span><span class="o">/</span><span class="n">nprocz</span>
<a name="ln-61"></a>   <span class="k">end if</span>
<a name="ln-62"></a><span class="k">   if</span> <span class="p">(</span><span class="n">nprocx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">nprocy</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">nprocz</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-63"></a>       <span class="n">nprocx</span><span class="o">*</span><span class="n">nprocy</span><span class="o">*</span><span class="n">nprocz</span> <span class="o">/=</span> <span class="n">mpi_size</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-64"></a><span class="k">    if</span> <span class="p">(</span><span class="n">mpi_rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-65"></a><span class="k">     write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Invalid MPI decomposition&#39;</span>
<a name="ln-66"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;mpi_size =&#39;</span><span class="p">,</span> <span class="n">mpi_size</span>
<a name="ln-67"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocx =&#39;</span><span class="p">,</span> <span class="n">nprocx</span><span class="p">,</span> <span class="s1">&#39;nprocy =&#39;</span><span class="p">,</span> <span class="n">nprocy</span><span class="p">,</span> <span class="s1">&#39;nprocz =&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-68"></a>      <span class="n">nprocz</span>
<a name="ln-69"></a>     <span class="k">stop </span><span class="mi">674</span>
<a name="ln-70"></a>    <span class="k">end if</span>
<a name="ln-71"></a><span class="k">   end if</span>
<a name="ln-72"></a><span class="k">  end subroutine</span>
<a name="ln-73"></a>
<a name="ln-74"></a><span class="k">  subroutine </span><span class="n">start_parallel</span><span class="p">(</span><span class="n">ncmp</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">,</span> <span class="n">b_ind</span><span class="p">)</span>
<a name="ln-75"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ncmp</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">,</span> <span class="n">b_ind</span>
<a name="ln-76"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">pen</span><span class="p">,</span> <span class="n">pkind</span><span class="p">,</span> <span class="n">bkind</span>
<a name="ln-77"></a>
<a name="ln-78"></a>   <span class="k">call </span><span class="n">mpi_init</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<a name="ln-79"></a>   <span class="k">call </span><span class="n">mpi_comm_size</span><span class="p">(</span><span class="n">mpi_comm_world</span><span class="p">,</span> <span class="n">mpi_size</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-80"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">mpi_comm_world</span><span class="p">,</span> <span class="n">mpi_rank</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-81"></a>
<a name="ln-82"></a>   <span class="k">call </span><span class="n">check_decomposition</span>
<a name="ln-83"></a>   <span class="c">!===================================</span>
<a name="ln-84"></a>   <span class="n">npe_xloc</span> <span class="o">=</span> <span class="n">nprocx</span>
<a name="ln-85"></a>   <span class="n">npe_yloc</span> <span class="o">=</span> <span class="n">nprocy</span>
<a name="ln-86"></a>   <span class="n">npe_zloc</span> <span class="o">=</span> <span class="n">nprocz</span>
<a name="ln-87"></a>   <span class="n">npe</span> <span class="o">=</span> <span class="n">mpi_size</span>
<a name="ln-88"></a>
<a name="ln-89"></a>   <span class="n">pe_min</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-90"></a>   <span class="n">pe_max</span> <span class="o">=</span> <span class="n">npe</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-91"></a>
<a name="ln-92"></a>   <span class="n">mype</span> <span class="o">=</span> <span class="n">mpi_rank</span>
<a name="ln-93"></a>   <span class="n">pe0</span> <span class="o">=</span> <span class="p">(</span><span class="n">mype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-94"></a>   <span class="n">pe1</span> <span class="o">=</span> <span class="p">(</span><span class="n">mype</span> <span class="o">==</span> <span class="n">pe_max</span><span class="p">)</span>
<a name="ln-95"></a>
<a name="ln-96"></a>   <span class="n">prl</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-97"></a>   <span class="n">prlx</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_xloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-98"></a>   <span class="n">prly</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_yloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-99"></a>   <span class="n">prlz</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_zloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-100"></a>
<a name="ln-101"></a>   <span class="n">comm</span> <span class="o">=</span> <span class="n">mpi_comm_world</span>
<a name="ln-102"></a>
<a name="ln-103"></a>   <span class="n">mpi_sd</span> <span class="o">=</span> <span class="n">mpi_double_precision</span>
<a name="ln-104"></a>
<a name="ln-105"></a>   <span class="k">call </span><span class="n">mpi_type_contiguous</span><span class="p">(</span><span class="n">ncmp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">partype</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-106"></a>   <span class="k">call </span><span class="n">mpi_type_commit</span><span class="p">(</span><span class="n">partype</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-107"></a>
<a name="ln-108"></a>   <span class="c">!================</span>
<a name="ln-109"></a>   <span class="n">ndims</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-110"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_yloc</span>
<a name="ln-111"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_zloc</span>
<a name="ln-112"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_xloc</span>
<a name="ln-113"></a>   <span class="c">!================</span>
<a name="ln-114"></a>   <span class="n">imodzx</span> <span class="o">=</span> <span class="n">mype</span><span class="o">/</span><span class="n">npe_yloc</span>
<a name="ln-115"></a>   <span class="n">imody</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">mype</span><span class="p">,</span> <span class="n">npe_yloc</span><span class="p">)</span>
<a name="ln-116"></a>   <span class="n">imodz</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">imodzx</span><span class="p">,</span> <span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-117"></a>   <span class="n">imodx</span> <span class="o">=</span> <span class="n">imodzx</span><span class="o">/</span><span class="n">npe_zloc</span>
<a name="ln-118"></a>
<a name="ln-119"></a>   <span class="n">imodyx</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="n">npe_zloc</span><span class="o">*</span><span class="n">imodx</span>
<a name="ln-120"></a>   <span class="n">imodyz</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="n">imodz</span>
<a name="ln-121"></a>   <span class="c">!======================</span>
<a name="ln-122"></a>   <span class="c">!=================</span>
<a name="ln-123"></a>
<a name="ln-124"></a>   <span class="c">!================= MPI cartesiantopology with (imody,imodz,imodx) coordinates</span>
<a name="ln-125"></a>   <span class="c">! mype=imody+npe_yloc*imodzx</span>
<a name="ln-126"></a>   <span class="c">! imodzx=imodz+npe_zloc*imodx</span>
<a name="ln-127"></a>   <span class="c">!----------------------------</span>
<a name="ln-128"></a>   <span class="c">! mype=imodyx+npe_yloc*imodz</span>
<a name="ln-129"></a>   <span class="c">! imodyx=imody+npe_yloc*npe_zloc*imodx</span>
<a name="ln-130"></a>   <span class="c">!===================</span>
<a name="ln-131"></a>   <span class="c">! mype=imodyz+npe_yloc*npe_zloc*imodx</span>
<a name="ln-132"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">imodz</span> <span class="o">+</span> <span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">imodx</span><span class="p">)</span>
<a name="ln-133"></a>   <span class="c">! imodyz=imody+npe_yloc*imodz</span>
<a name="ln-134"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">imodx</span>
<a name="ln-135"></a>   <span class="c">!==========================</span>
<a name="ln-136"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">imodz</span>
<a name="ln-137"></a>   <span class="c">!======================</span>
<a name="ln-138"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">imody</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-139"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-140"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-141"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-142"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-143"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-144"></a>   <span class="c">!imodzx=&gt;&gt; all pes in the (imodz,imodx) plane for given imody</span>
<a name="ln-145"></a>   <span class="c">!imodyx=&gt; all pes in the (imody,imodx) plane for given imodz</span>
<a name="ln-146"></a>   <span class="c">!all pes in the (imody,imodz) plane for given imodx</span>
<a name="ln-147"></a>   <span class="c">!============ for diagnostic</span>
<a name="ln-148"></a>   <span class="n">pe0y</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-149"></a>   <span class="n">pe1y</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">==</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-150"></a>   <span class="n">pe0z</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-151"></a>   <span class="n">pe1z</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">==</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-152"></a>   <span class="n">pex0</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-153"></a>   <span class="n">pex1</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">==</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-154"></a>   <span class="c">!===========================</span>
<a name="ln-155"></a>   <span class="n">pe_min_y</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-156"></a>   <span class="n">pe_max_y</span> <span class="o">=</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-157"></a>   <span class="n">pe_min_z</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-158"></a>   <span class="n">pe_max_z</span> <span class="o">=</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-159"></a>   <span class="n">pe_min_x</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-160"></a>   <span class="n">pe_max_x</span> <span class="o">=</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-161"></a>   <span class="c">!===========================</span>
<a name="ln-162"></a>   <span class="n">xl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-163"></a>   <span class="n">xr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-164"></a>   <span class="n">yl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-165"></a>   <span class="n">yr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-166"></a>   <span class="n">zl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-167"></a>   <span class="n">zr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-168"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pex0</span><span class="p">)</span> <span class="n">xl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-169"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pex1</span><span class="p">)</span> <span class="n">xr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-170"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0y</span><span class="p">)</span> <span class="n">yl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-171"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe1y</span><span class="p">)</span> <span class="n">yr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-172"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0z</span><span class="p">)</span> <span class="n">zl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-173"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe1z</span><span class="p">)</span> <span class="n">zr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-174"></a>   <span class="n">pe0x</span> <span class="o">=</span> <span class="n">pex0</span>
<a name="ln-175"></a>   <span class="n">pe1x</span> <span class="o">=</span> <span class="n">pex1</span>
<a name="ln-176"></a>   <span class="c">! Logical idensification of mpi boundary coordinates</span>
<a name="ln-177"></a>   <span class="n">pkind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">)</span>
<a name="ln-178"></a>   <span class="n">bkind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b_ind</span><span class="p">)</span>
<a name="ln-179"></a>   <span class="c">!====================</span>
<a name="ln-180"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_npart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">pkind</span><span class="p">))</span>
<a name="ln-181"></a>   <span class="n">loc_npart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">pkind</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-182"></a>   <span class="c">!========================================</span>
<a name="ln-183"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_ne_ionz</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-184"></a>   <span class="n">loc_ne_ionz</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-185"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-186"></a>   <span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-187"></a>
<a name="ln-188"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">bkind</span><span class="p">))</span>
<a name="ln-189"></a>   <span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">bkind</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-190"></a>
<a name="ln-191"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">yp_next</span><span class="p">(</span><span class="n">npe_yloc</span><span class="p">),</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">npe_yloc</span><span class="p">))</span>
<a name="ln-192"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">zp_next</span><span class="p">(</span><span class="n">npe_zloc</span><span class="p">),</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">npe_zloc</span><span class="p">))</span>
<a name="ln-193"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">xp_next</span><span class="p">(</span><span class="n">npe_xloc</span><span class="p">),</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">npe_xloc</span><span class="p">))</span>
<a name="ln-194"></a>
<a name="ln-195"></a>   <span class="n">yp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-196"></a>   <span class="n">yp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-197"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_yloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-198"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-199"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-200"></a>     <span class="n">yp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_yloc</span><span class="p">)</span>
<a name="ln-201"></a>     <span class="c">!============================</span>
<a name="ln-202"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-203"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_yloc</span>
<a name="ln-204"></a>     <span class="n">yp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-205"></a>    <span class="k">end do</span>
<a name="ln-206"></a><span class="k">   end if</span>
<a name="ln-207"></a><span class="k">   </span><span class="n">zp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-208"></a>   <span class="n">zp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-209"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_zloc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-210"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-211"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-212"></a>     <span class="n">zp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-213"></a>
<a name="ln-214"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-215"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_zloc</span>
<a name="ln-216"></a>     <span class="n">zp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-217"></a>    <span class="k">end do</span>
<a name="ln-218"></a><span class="k">   end if</span>
<a name="ln-219"></a><span class="k">   </span><span class="n">xp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-220"></a>   <span class="n">xp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-221"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prlx</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-222"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-223"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-224"></a>     <span class="n">xp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_xloc</span><span class="p">)</span>
<a name="ln-225"></a>     <span class="c">!============= output arrays</span>
<a name="ln-226"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-227"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_xloc</span>
<a name="ln-228"></a>     <span class="n">xp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-229"></a>    <span class="k">end do</span>
<a name="ln-230"></a><span class="k">   end if</span>
<a name="ln-231"></a>
<a name="ln-232"></a>   <span class="c">!==========================================</span>
<a name="ln-233"></a>   <span class="c">! INITIALIZE THE RANDOM SEED FOR EVERY MYPE</span>
<a name="ln-234"></a>   <span class="c">!==========================================</span>
<a name="ln-235"></a>
<a name="ln-236"></a>   <span class="k">call </span><span class="n">init_random_seed</span><span class="p">(</span><span class="n">mype</span><span class="p">)</span>
<a name="ln-237"></a>   <span class="c">!call processor_grid_diag</span>
<a name="ln-238"></a>
<a name="ln-239"></a>  <span class="k">end subroutine</span>
<a name="ln-240"></a>
<a name="ln-241"></a><span class="k">  subroutine </span><span class="n">mpi_write_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-242"></a>
<a name="ln-243"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-244"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-245"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-246"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-247"></a>   <span class="c">!===========================</span>
<a name="ln-248"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-249"></a>   <span class="c">!========================</span>
<a name="ln-250"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-251"></a>                      <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-252"></a>
<a name="ln-253"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-254"></a>                          <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-255"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-256"></a>
<a name="ln-257"></a>  <span class="k">end subroutine</span>
<a name="ln-258"></a>  <span class="c">!======== each process acces thefile and writes at disp(byte) coordinate</span>
<a name="ln-259"></a>  <span class="k">subroutine </span><span class="n">mpi_write_row_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-260"></a>
<a name="ln-261"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-262"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-263"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-264"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-265"></a>
<a name="ln-266"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-267"></a>   <span class="c">!=======================================</span>
<a name="ln-268"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-269"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-270"></a>
<a name="ln-271"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-272"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-273"></a>                          <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-274"></a>   <span class="c">! mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-275"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-276"></a>  <span class="k">end subroutine</span>
<a name="ln-277"></a>  <span class="c">!mpi_info_null, ierr)</span>
<a name="ln-278"></a>  <span class="k">subroutine </span><span class="n">mpi_write_col_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-279"></a>
<a name="ln-280"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-281"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-282"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-283"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-284"></a>
<a name="ln-285"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-286"></a>   <span class="c">!===================</span>
<a name="ln-287"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-288"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-289"></a>
<a name="ln-290"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-291"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-292"></a>                          <span class="n">mpi_double_precision</span><span class="p">,</span> <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-293"></a>   <span class="c">! mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-294"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-295"></a>   <span class="c">! mpi_info_null, ierr)</span>
<a name="ln-296"></a>  <span class="k">end subroutine</span>
<a name="ln-297"></a>
<a name="ln-298"></a><span class="k">  subroutine </span><span class="n">mpi_read_col_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-299"></a>
<a name="ln-300"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-301"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-302"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-303"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-304"></a>
<a name="ln-305"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-306"></a>   <span class="c">!========================</span>
<a name="ln-307"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_rdonly</span><span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-308"></a>                      <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-309"></a>
<a name="ln-310"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-311"></a>   <span class="k">call </span><span class="n">mpi_file_read_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-312"></a>                         <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-313"></a>   <span class="c">!mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-314"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-315"></a>   <span class="c">!mpi_info_null, ierr)</span>
<a name="ln-316"></a>  <span class="k">end subroutine</span>
<a name="ln-317"></a>
<a name="ln-318"></a><span class="k">  subroutine </span><span class="n">mpi_read_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-319"></a>
<a name="ln-320"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-321"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-322"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-323"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-324"></a>
<a name="ln-325"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-326"></a>   <span class="c">!=======================================</span>
<a name="ln-327"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_rdonly</span><span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-328"></a>                      <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-329"></a>
<a name="ln-330"></a>   <span class="k">call </span><span class="n">mpi_file_read_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-331"></a>                         <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-332"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-333"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-334"></a>   <span class="c">! mpi_sd, &#39;native&#39;, mpi_info_null, ierr)</span>
<a name="ln-335"></a>  <span class="k">end subroutine</span>
<a name="ln-336"></a>  <span class="c">!call mpi_file_seek(thefile,disp,whence,ierr)</span>
<a name="ln-337"></a>  <span class="k">subroutine </span><span class="n">mpi_write_part</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-338"></a>
<a name="ln-339"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-340"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-341"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-342"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-343"></a>
<a name="ln-344"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-345"></a>   <span class="c">!===============================</span>
<a name="ln-346"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-347"></a>                      <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-348"></a>
<a name="ln-349"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-350"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-351"></a>
<a name="ln-352"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-353"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-354"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-355"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-356"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-357"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-358"></a>  <span class="k">end subroutine</span>
<a name="ln-359"></a>  <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-360"></a>
<a name="ln-361"></a>  <span class="k">subroutine </span><span class="n">mpi_write_part_col</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-362"></a>
<a name="ln-363"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-364"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-365"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-366"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-367"></a>   <span class="c">!========================</span>
<a name="ln-368"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-369"></a>   <span class="c">!========================</span>
<a name="ln-370"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-371"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-372"></a>
<a name="ln-373"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-374"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-375"></a>
<a name="ln-376"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-377"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-378"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-379"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-380"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-381"></a>  <span class="k">end subroutine</span>
<a name="ln-382"></a>
<a name="ln-383"></a><span class="k">  subroutine </span><span class="n">mpi_write_field</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-384"></a>                             <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-385"></a>
<a name="ln-386"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-387"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">header</span><span class="p">(:)</span>
<a name="ln-388"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-389"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-390"></a>
<a name="ln-391"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-392"></a>   <span class="c">!========================</span>
<a name="ln-393"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-394"></a>                      <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-395"></a>
<a name="ln-396"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-397"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-398"></a>
<a name="ln-399"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-400"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-401"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-402"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-403"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-404"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-405"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-406"></a>  <span class="k">end subroutine</span>
<a name="ln-407"></a>
<a name="ln-408"></a><span class="k">  subroutine </span><span class="n">mpi_write_field_col</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-409"></a>                                 <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-410"></a>   <span class="c">!========================</span>
<a name="ln-411"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-412"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">header</span><span class="p">(:)</span>
<a name="ln-413"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-414"></a>   <span class="kt">character</span><span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-415"></a>   <span class="c">!different from mpi_write_field because of the different communicator in</span>
<a name="ln-416"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-417"></a>   <span class="c">!mpi_file_open</span>
<a name="ln-418"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span> <span class="o">+</span> <span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-419"></a>                      <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-420"></a>
<a name="ln-421"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-422"></a>                          <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-423"></a>
<a name="ln-424"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-425"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-426"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-427"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-428"></a>                       <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-429"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-430"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-431"></a>  <span class="k">end subroutine</span>
<a name="ln-432"></a>
<a name="ln-433"></a><span class="k">  subroutine </span><span class="n">End_parallel</span>
<a name="ln-434"></a>
<a name="ln-435"></a>   <span class="k">call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<a name="ln-436"></a>
<a name="ln-437"></a>  <span class="k">end subroutine</span>
<a name="ln-438"></a>
<a name="ln-439"></a><span class="k">  subroutine </span><span class="n">exchange_idata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">idat</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-440"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-441"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">idat</span><span class="p">(:)</span>
<a name="ln-442"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-443"></a>
<a name="ln-444"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-445"></a>    <span class="c">!=======================</span>
<a name="ln-446"></a>    <span class="k">call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-447"></a>    <span class="c">!=====================================</span>
<a name="ln-448"></a>   <span class="k">else</span>
<a name="ln-449"></a>
<a name="ln-450"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-451"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-452"></a>   <span class="k">end if</span>
<a name="ln-453"></a>
<a name="ln-454"></a><span class="k">  end subroutine</span>
<a name="ln-455"></a>
<a name="ln-456"></a><span class="k">  subroutine </span><span class="n">exchange_2d_idata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">idat</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-457"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-458"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">idat</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-459"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-460"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-461"></a>
<a name="ln-462"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-463"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-464"></a>
<a name="ln-465"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-466"></a>
<a name="ln-467"></a>   <span class="k">else</span>
<a name="ln-468"></a>
<a name="ln-469"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-470"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-471"></a>   <span class="k">end if</span>
<a name="ln-472"></a>
<a name="ln-473"></a><span class="k">  end subroutine</span>
<a name="ln-474"></a>
<a name="ln-475"></a><span class="k">  subroutine </span><span class="n">exchange_3d_sp_data</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-476"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-477"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-478"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-479"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-480"></a>
<a name="ln-481"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span><span class="o">*</span><span class="n">n3</span>
<a name="ln-482"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-483"></a>
<a name="ln-484"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-485"></a>    <span class="c">!====================</span>
<a name="ln-486"></a>   <span class="k">else</span>
<a name="ln-487"></a>
<a name="ln-488"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-489"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-490"></a>   <span class="k">end if</span>
<a name="ln-491"></a>
<a name="ln-492"></a><span class="k">  end subroutine</span>
<a name="ln-493"></a>
<a name="ln-494"></a><span class="k">  subroutine </span><span class="n">exchange_1d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-495"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-496"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:)</span>
<a name="ln-497"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-498"></a>
<a name="ln-499"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-500"></a>
<a name="ln-501"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-502"></a>
<a name="ln-503"></a>   <span class="k">else</span>
<a name="ln-504"></a>    <span class="c">!====================</span>
<a name="ln-505"></a>    <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-506"></a>   <span class="k">end if</span>
<a name="ln-507"></a>
<a name="ln-508"></a><span class="k">  end subroutine</span>
<a name="ln-509"></a>
<a name="ln-510"></a><span class="k">  subroutine </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-511"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-512"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-513"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-514"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-515"></a>
<a name="ln-516"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-517"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-518"></a>
<a name="ln-519"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-520"></a>
<a name="ln-521"></a>   <span class="k">else</span>
<a name="ln-522"></a>
<a name="ln-523"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-524"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-525"></a>   <span class="k">end if</span>
<a name="ln-526"></a>
<a name="ln-527"></a><span class="k">  end subroutine</span>
<a name="ln-528"></a><span class="c">!====================</span>
<a name="ln-529"></a>  <span class="k">subroutine </span><span class="n">exchange_3d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span><span class="p">)</span>
<a name="ln-530"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span>
<a name="ln-531"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-532"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-533"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span>
<a name="ln-534"></a>
<a name="ln-535"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-536"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-537"></a>
<a name="ln-538"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-539"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-540"></a>    <span class="c">!=========================</span>
<a name="ln-541"></a>   <span class="k">else</span>
<a name="ln-542"></a>
<a name="ln-543"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-544"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-545"></a>   <span class="k">end if</span>
<a name="ln-546"></a><span class="k">  end subroutine</span>
<a name="ln-547"></a><span class="k">  subroutine </span><span class="n">exchange_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span><span class="p">)</span>
<a name="ln-548"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span>
<a name="ln-549"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-550"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-551"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span>
<a name="ln-552"></a>
<a name="ln-553"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-554"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-555"></a>
<a name="ln-556"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-557"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-558"></a>    <span class="c">!=========================</span>
<a name="ln-559"></a>   <span class="k">else</span>
<a name="ln-560"></a>
<a name="ln-561"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-562"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-563"></a>   <span class="k">end if</span>
<a name="ln-564"></a>
<a name="ln-565"></a><span class="k">  end subroutine</span>
<a name="ln-566"></a>
<a name="ln-567"></a><span class="k">  subroutine </span><span class="n">realvec_distribute</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nproc</span><span class="p">)</span>
<a name="ln-568"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nproc</span>
<a name="ln-569"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rs</span>
<a name="ln-570"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv</span><span class="p">(:),</span> <span class="n">rc</span>
<a name="ln-571"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span>
<a name="ln-572"></a>
<a name="ln-573"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-574"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">mype</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-575"></a>   <span class="k">else</span>
<a name="ln-576"></a><span class="k">    </span><span class="n">rv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span>
<a name="ln-577"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nproc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-578"></a>     <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-579"></a>     <span class="n">rv</span><span class="p">(</span><span class="n">ipe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rc</span>
<a name="ln-580"></a>    <span class="k">end do</span>
<a name="ln-581"></a><span class="k">   end if</span>
<a name="ln-582"></a>
<a name="ln-583"></a><span class="k">  end subroutine</span>
<a name="ln-584"></a>
<a name="ln-585"></a><span class="k">  subroutine </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">nproc</span><span class="p">)</span>
<a name="ln-586"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nproc</span>
<a name="ln-587"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nc</span><span class="p">(:)</span>
<a name="ln-588"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">nr</span>
<a name="ln-589"></a>
<a name="ln-590"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-591"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">mype</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-592"></a>   <span class="k">else</span>
<a name="ln-593"></a><span class="k">    </span><span class="n">nc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ns</span>
<a name="ln-594"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nproc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-595"></a>     <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-596"></a>     <span class="n">nc</span><span class="p">(</span><span class="n">ipe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nr</span>
<a name="ln-597"></a>    <span class="k">end do</span>
<a name="ln-598"></a><span class="k">   end if</span>
<a name="ln-599"></a><span class="k">   call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">nproc</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-600"></a>
<a name="ln-601"></a>  <span class="k">end subroutine</span>
<a name="ln-602"></a>
<a name="ln-603"></a><span class="k">  subroutine </span><span class="n">sr_idata</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-604"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-605"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nr</span>
<a name="ln-606"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-607"></a>
<a name="ln-608"></a>   <span class="n">nr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-609"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-610"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-611"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-612"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-613"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-614"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> <span class="c">!=============</span>
<a name="ln-615"></a>    <span class="k">else</span>
<a name="ln-616"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-617"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span> <span class="c">!sends to left ns data</span>
<a name="ln-618"></a>    <span class="k">end if</span>
<a name="ln-619"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-620"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-621"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-622"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-623"></a>    <span class="k">else</span>
<a name="ln-624"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-625"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-626"></a>    <span class="k">end if</span>
<a name="ln-627"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-628"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-629"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-630"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-631"></a>    <span class="k">else</span>
<a name="ln-632"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-633"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-634"></a>    <span class="k">end if</span>
<a name="ln-635"></a><span class="k">   end select</span>
<a name="ln-636"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-637"></a>                     <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-638"></a>   <span class="c">!receives from right nr daata</span>
<a name="ln-639"></a>  <span class="k">end subroutine</span>
<a name="ln-640"></a>  <span class="c">!sends to right ns data</span>
<a name="ln-641"></a>  <span class="k">subroutine </span><span class="n">sr_pdata</span><span class="p">(</span><span class="n">sdata</span><span class="p">,</span> <span class="n">rdata</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-642"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sdata</span><span class="p">(:)</span>
<a name="ln-643"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rdata</span><span class="p">(:)</span>
<a name="ln-644"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-645"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span>
<a name="ln-646"></a>   <span class="c">!receives form left nr data</span>
<a name="ln-647"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-648"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-649"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-650"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-651"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-652"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-653"></a>    <span class="k">else</span>
<a name="ln-654"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-655"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-656"></a>    <span class="k">end if</span>
<a name="ln-657"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-658"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-659"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-660"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-661"></a>    <span class="k">else</span>
<a name="ln-662"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-663"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-664"></a>    <span class="k">end if</span>
<a name="ln-665"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-666"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-667"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-668"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-669"></a>    <span class="k">else</span>
<a name="ln-670"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-671"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-672"></a>    <span class="k">end if</span>
<a name="ln-673"></a><span class="k">   end select</span>
<a name="ln-674"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ns</span><span class="o">*</span><span class="n">nr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-675"></a><span class="k">    call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">sdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ns</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">nr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-676"></a>                      <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-677"></a>   <span class="k">else</span>
<a name="ln-678"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ns</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">sdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ns</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-679"></a>                              <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-680"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">nr</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-681"></a>                              <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-682"></a>   <span class="k">end if</span>
<a name="ln-683"></a><span class="k">  end subroutine</span>
<a name="ln-684"></a>
<a name="ln-685"></a><span class="k">  subroutine </span><span class="n">sr_vidata</span><span class="p">(</span><span class="n">sidat</span><span class="p">,</span> <span class="n">ridat</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-686"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-687"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sidat</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span>
<a name="ln-688"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ridat</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span>
<a name="ln-689"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">nq</span>
<a name="ln-690"></a>   <span class="c">!==================</span>
<a name="ln-691"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-692"></a>   <span class="n">nq</span> <span class="o">=</span> <span class="n">n2</span><span class="o">*</span><span class="n">n3</span>
<a name="ln-693"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-694"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-695"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-696"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-697"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-698"></a>    <span class="k">else</span>
<a name="ln-699"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-700"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-701"></a>    <span class="k">end if</span>
<a name="ln-702"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-703"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-704"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-705"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-706"></a>    <span class="k">else</span>
<a name="ln-707"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-708"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-709"></a>    <span class="k">end if</span>
<a name="ln-710"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-711"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-712"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-713"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-714"></a>    <span class="k">else</span>
<a name="ln-715"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-716"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-717"></a>    <span class="k">end if</span>
<a name="ln-718"></a><span class="k">   end select</span>
<a name="ln-719"></a>
<a name="ln-720"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">sidat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nq</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">ridat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-721"></a>                     <span class="n">nq</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-722"></a>   <span class="c">!====================</span>
<a name="ln-723"></a>  <span class="k">end subroutine</span>
<a name="ln-724"></a>
<a name="ln-725"></a><span class="k">  subroutine </span><span class="n">exchange_pdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-726"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-727"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-728"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pdata</span><span class="p">(:)</span>
<a name="ln-729"></a>
<a name="ln-730"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-731"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">pdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-732"></a>
<a name="ln-733"></a>   <span class="k">else</span>
<a name="ln-734"></a>
<a name="ln-735"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">pdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-736"></a>                  <span class="n">error</span><span class="p">)</span>
<a name="ln-737"></a>   <span class="k">end if</span>
<a name="ln-738"></a>
<a name="ln-739"></a><span class="k">  end subroutine</span>
<a name="ln-740"></a>
<a name="ln-741"></a><span class="k">  subroutine </span><span class="n">exchange_rdata</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-742"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff</span><span class="p">(:)</span>
<a name="ln-743"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-744"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-745"></a>
<a name="ln-746"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-747"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-748"></a>   <span class="k">else</span>
<a name="ln-749"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-750"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-751"></a>   <span class="k">end if</span>
<a name="ln-752"></a>
<a name="ln-753"></a><span class="k">  end subroutine</span>
<a name="ln-754"></a>
<a name="ln-755"></a><span class="k">  subroutine </span><span class="n">exchange_rdata_int</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-756"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff</span><span class="p">(:)</span>
<a name="ln-757"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-758"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-759"></a>
<a name="ln-760"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-761"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-762"></a>   <span class="k">else</span>
<a name="ln-763"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-764"></a>                  <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-765"></a>   <span class="k">end if</span>
<a name="ln-766"></a>
<a name="ln-767"></a><span class="k">  end subroutine</span>
<a name="ln-768"></a>  <span class="c">!=======================</span>
<a name="ln-769"></a>  <span class="k">subroutine </span><span class="n">vint_2d_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<a name="ln-770"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span>
<a name="ln-771"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:)</span> <span class="kd">::</span> <span class="n">mydat</span>
<a name="ln-772"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-773"></a>
<a name="ln-774"></a>   <span class="n">nt</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-775"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-776"></a>
<a name="ln-777"></a>  <span class="k">end subroutine</span>
<a name="ln-778"></a>
<a name="ln-779"></a><span class="k">  subroutine </span><span class="n">vint_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-780"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-781"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mydat</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-782"></a>
<a name="ln-783"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-784"></a>
<a name="ln-785"></a>  <span class="k">end subroutine</span>
<a name="ln-786"></a>
<a name="ln-787"></a><span class="k">  subroutine </span><span class="n">int_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">)</span>
<a name="ln-788"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mydat</span>
<a name="ln-789"></a>
<a name="ln-790"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-791"></a>
<a name="ln-792"></a>  <span class="k">end subroutine</span>
<a name="ln-793"></a>
<a name="ln-794"></a><span class="k">  subroutine </span><span class="n">all_gather_dpreal</span><span class="p">(</span><span class="n">rv_send</span><span class="p">,</span> <span class="n">rv_recv</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-795"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv_send</span><span class="p">(:),</span> <span class="n">rv_recv</span><span class="p">(:)</span>
<a name="ln-796"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dir</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-797"></a>
<a name="ln-798"></a>   <span class="k">call </span><span class="n">mpi_allgather</span><span class="p">(</span><span class="n">rv_send</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">rv_recv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-799"></a>                      <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-800"></a>  <span class="k">end subroutine</span>
<a name="ln-801"></a><span class="k">  subroutine </span><span class="n">allreduce_dpreal</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-802"></a>
<a name="ln-803"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-804"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv_loc</span><span class="p">(:)</span>
<a name="ln-805"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv</span><span class="p">(:)</span>
<a name="ln-806"></a>
<a name="ln-807"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-808"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-809"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!min</span>
<a name="ln-810"></a>
<a name="ln-811"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-812"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c">!sum</span>
<a name="ln-813"></a>
<a name="ln-814"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-815"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c">!max</span>
<a name="ln-816"></a>
<a name="ln-817"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-818"></a>    <span class="k">end select</span>
<a name="ln-819"></a>
<a name="ln-820"></a><span class="k">   else</span>
<a name="ln-821"></a><span class="k">    </span><span class="n">rv</span> <span class="o">=</span> <span class="n">rv_loc</span>
<a name="ln-822"></a>   <span class="k">end if</span>
<a name="ln-823"></a>
<a name="ln-824"></a><span class="k">  end subroutine</span>
<a name="ln-825"></a>
<a name="ln-826"></a><span class="cp">#ifdef ENABLE_MPI_LONG_INT</span>
<a name="ln-827"></a>  <span class="c">! WARNING: unsupported on some architecture!!</span>
<a name="ln-828"></a>  <span class="k">subroutine </span><span class="n">allreduce_big_int</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
<a name="ln-829"></a>
<a name="ln-830"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n0</span>
<a name="ln-831"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span>
<a name="ln-832"></a>
<a name="ln-833"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-834"></a>
<a name="ln-835"></a><span class="k">    call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_long_int</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-836"></a>   <span class="k">end if</span>
<a name="ln-837"></a>   <span class="c">!===========================</span>
<a name="ln-838"></a>  <span class="k">end subroutine</span>
<a name="ln-839"></a><span class="cp">#endif</span>
<a name="ln-840"></a>
<a name="ln-841"></a>  <span class="k">subroutine </span><span class="n">allreduce_sint</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">)</span>
<a name="ln-842"></a>
<a name="ln-843"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span>
<a name="ln-844"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt0</span>
<a name="ln-845"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span>
<a name="ln-846"></a>
<a name="ln-847"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-848"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-849"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!---------------------------------------------</span>
<a name="ln-850"></a>
<a name="ln-851"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-852"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-853"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-854"></a>
<a name="ln-855"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-856"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-857"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-858"></a>
<a name="ln-859"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-860"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-861"></a>    <span class="k">end select</span>
<a name="ln-862"></a><span class="k">    call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-863"></a>   <span class="k">else</span>
<a name="ln-864"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt0</span>
<a name="ln-865"></a>   <span class="k">end if</span>
<a name="ln-866"></a>
<a name="ln-867"></a><span class="k">  end subroutine</span>
<a name="ln-868"></a>
<a name="ln-869"></a><span class="k">  subroutine </span><span class="n">allreduce_vint</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-870"></a>
<a name="ln-871"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-872"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt0</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-873"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-874"></a>
<a name="ln-875"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-876"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-877"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!max</span>
<a name="ln-878"></a>
<a name="ln-879"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-880"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-881"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-882"></a>     <span class="c">!==============================</span>
<a name="ln-883"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-884"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-885"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-886"></a>
<a name="ln-887"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-888"></a>                     <span class="n">error</span><span class="p">)</span>
<a name="ln-889"></a>    <span class="k">end select</span>
<a name="ln-890"></a><span class="k">    call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-891"></a>   <span class="k">else</span>
<a name="ln-892"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt0</span>
<a name="ln-893"></a>   <span class="k">end if</span>
<a name="ln-894"></a>
<a name="ln-895"></a><span class="k">  end subroutine</span>
<a name="ln-896"></a>
<a name="ln-897"></a><span class="k">  subroutine </span><span class="n">bcast_grdata</span><span class="p">(</span><span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
<a name="ln-898"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">nc</span>
<a name="ln-899"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-900"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-901"></a>
<a name="ln-902"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span><span class="o">*</span><span class="n">n3</span><span class="o">*</span><span class="n">nc</span>
<a name="ln-903"></a>
<a name="ln-904"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-905"></a>
<a name="ln-906"></a>  <span class="k">end subroutine</span>
<a name="ln-907"></a>
<a name="ln-908"></a><span class="k">  subroutine </span><span class="n">bcast_realv_sum</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-909"></a>
<a name="ln-910"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span>
<a name="ln-911"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-912"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_prl</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-913"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-914"></a>
<a name="ln-915"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-916"></a>
<a name="ln-917"></a><span class="k">    call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-918"></a>                    <span class="n">error</span><span class="p">)</span>
<a name="ln-919"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span> <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-920"></a>   <span class="k">else</span>
<a name="ln-921"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt_prl</span>
<a name="ln-922"></a>   <span class="k">end if</span>
<a name="ln-923"></a>
<a name="ln-924"></a><span class="k">  end subroutine</span>
<a name="ln-925"></a>
<a name="ln-926"></a><span class="k">  subroutine </span><span class="n">bcast_int_sum</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">)</span>
<a name="ln-927"></a>
<a name="ln-928"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_prl</span>
<a name="ln-929"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span>
<a name="ln-930"></a>
<a name="ln-931"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-932"></a>
<a name="ln-933"></a><span class="k">    call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-934"></a>                    <span class="n">error</span><span class="p">)</span>
<a name="ln-935"></a>    <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-936"></a>   <span class="k">else</span>
<a name="ln-937"></a><span class="k">    </span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt_prl</span>
<a name="ln-938"></a>   <span class="k">end if</span>
<a name="ln-939"></a><span class="k">  end subroutine</span>
<a name="ln-940"></a>
<a name="ln-941"></a><span class="k">  subroutine </span><span class="n">real_bcast</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">ndt</span><span class="p">)</span>
<a name="ln-942"></a>
<a name="ln-943"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndt</span>
<a name="ln-944"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">ndt</span><span class="p">)</span>
<a name="ln-945"></a>
<a name="ln-946"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">ndt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-947"></a>
<a name="ln-948"></a>  <span class="k">end subroutine</span>
<a name="ln-949"></a>
<a name="ln-950"></a><span class="k">  subroutine </span><span class="n">local_to_global_grdata</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">dir</span><span class="p">)</span>
<a name="ln-951"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:)</span>
<a name="ln-952"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:)</span>
<a name="ln-953"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-954"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-955"></a>
<a name="ln-956"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">250</span> <span class="o">+</span> <span class="n">ip</span>
<a name="ln-957"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-958"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-959"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-960"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-961"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-962"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-963"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-964"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-965"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-966"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-967"></a>   <span class="k">end select</span>
<a name="ln-968"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-969"></a>                     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-970"></a>
<a name="ln-971"></a>  <span class="k">end subroutine</span>
<a name="ln-972"></a>
<a name="ln-973"></a><span class="k">  subroutine </span><span class="n">exchange_bd_3d_data</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-974"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-975"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-976"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-977"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">hp_int</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">side</span>
<a name="ln-978"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-979"></a>
<a name="ln-980"></a>   <span class="c">!===============================</span>
<a name="ln-981"></a>   <span class="c">! side &gt; recievies next sends left</span>
<a name="ln-982"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">610</span>
<a name="ln-983"></a>
<a name="ln-984"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-985"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-986"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-987"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-988"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-989"></a>    <span class="k">else</span>
<a name="ln-990"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-991"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-992"></a>    <span class="k">end if</span>
<a name="ln-993"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-994"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-995"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-996"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-997"></a>    <span class="k">else</span>
<a name="ln-998"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-999"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1000"></a>    <span class="k">end if</span>
<a name="ln-1001"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1002"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1003"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1004"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1005"></a>    <span class="k">else</span>
<a name="ln-1006"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1007"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1008"></a>    <span class="k">end if</span>
<a name="ln-1009"></a><span class="k">   end select</span>
<a name="ln-1010"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lenwr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1011"></a>                     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-1012"></a>
<a name="ln-1013"></a>  <span class="k">end subroutine</span>
<a name="ln-1014"></a>
<a name="ln-1015"></a><span class="k">  subroutine </span><span class="n">exchange_bdx_data</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-1016"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:)</span>
<a name="ln-1017"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:)</span>
<a name="ln-1018"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-1019"></a>   <span class="kt">integer</span><span class="p">(</span><span class="n">hp_int</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">side</span>
<a name="ln-1020"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-1021"></a>
<a name="ln-1022"></a>   <span class="c">!===============================</span>
<a name="ln-1023"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">610</span>
<a name="ln-1024"></a>
<a name="ln-1025"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-1026"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1027"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1028"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1029"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1030"></a>    <span class="k">else</span>
<a name="ln-1031"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1032"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1033"></a>    <span class="k">end if</span>
<a name="ln-1034"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1035"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1036"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1037"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1038"></a>    <span class="k">else</span>
<a name="ln-1039"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1040"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1041"></a>    <span class="k">end if</span>
<a name="ln-1042"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1043"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1044"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1045"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1046"></a>    <span class="k">else</span>
<a name="ln-1047"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1048"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1049"></a>    <span class="k">end if</span>
<a name="ln-1050"></a><span class="k">   end select</span>
<a name="ln-1051"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenwr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1052"></a>                     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-1053"></a>
<a name="ln-1054"></a>  <span class="k">end subroutine</span>
<a name="ln-1055"></a>
<a name="ln-1056"></a><span class="k">  subroutine </span><span class="n">processor_grid_diag</span>
<a name="ln-1057"></a>   <span class="c">!============================</span>
<a name="ln-1058"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-1059"></a>   <span class="kt">character</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;          &#39;</span>
<a name="ln-1060"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">lun</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-1061"></a>
<a name="ln-1062"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">mype</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1063"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;(a9,i1)&#39;</span><span class="p">)</span> <span class="s1">&#39;proc_map0&#39;</span><span class="p">,</span> <span class="n">mype</span>
<a name="ln-1064"></a>   <span class="k">else</span>
<a name="ln-1065"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;(a8,i2)&#39;</span><span class="p">)</span> <span class="s1">&#39;proc_map&#39;</span><span class="p">,</span> <span class="n">mype</span>
<a name="ln-1066"></a>   <span class="k">end if</span>
<a name="ln-1067"></a><span class="k">   open</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">fname</span><span class="o">//</span><span class="s1">&#39;.dat&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">)</span>
<a name="ln-1068"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;== local carteisan ranks&#39;</span>
<a name="ln-1069"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span>
<a name="ln-1070"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">coor</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1071"></a>   <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1072"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== y-neighbors=========&#39;</span>
<a name="ln-1073"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1074"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== z-neighbors=========&#39;</span>
<a name="ln-1075"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1076"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== x-neighbors=========&#39;</span>
<a name="ln-1077"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1078"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;======== comm_col===========&#39;</span>
<a name="ln-1079"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1080"></a>   <span class="k">close</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span>
<a name="ln-1081"></a>
<a name="ln-1082"></a>  <span class="k">end subroutine</span>
<a name="ln-1083"></a>  <span class="c">!================== side &lt;0 receives from left   side &gt;0 receives from right</span>
<a name="ln-1084"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-08-08 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>